let e=null;const n=async function(){try{const n=await fetch("/api/firebase-config"),t=await n.json();return firebase.apps.length||firebase.initializeApp(t),e=firebase.database(),console.log("Firebase initialized successfully"),e}catch(e){return console.error("Firebase initialization failed:",e),null}}();function t(e){if("string"!=typeof e)return e;const n=document.createElement("div");return n.textContent=e,n.innerHTML}function a(e,n){const a=["b","i","u","strong","em","span","div","br","p","small"],i=n.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,(e,n)=>a.includes(n.toLowerCase())?e:t(e));e.innerHTML=i}const i={0:"Cahil",1:"Ä°lkokul",2:"Ortaokul",3:"Lise",4:"Ãœniversite",5:"YÃ¼ksek Lisans",6:"Doktora",7:"ProfesÃ¶r"},r=[0,2500,5e3,1e4,25e3,4e4,75e3,2e5],o={yumruk:{name:"Ã‡Ä±plak El",dmg:5,price:0,icon:"âœŠ"},sopa:{name:"Tahta Sopa",dmg:12,price:5e3,icon:"ğŸªµ"},bicak:{name:"PaslÄ± BÄ±Ã§ak",dmg:20,price:15e3,icon:"ğŸ”ª"},kilic:{name:"Demir KÄ±lÄ±Ã§",dmg:35,price:5e4,icon:"âš”ï¸"},balta:{name:"SavaÅŸ BaltasÄ±",dmg:55,price:12e4,icon:"ğŸª“"},katana:{name:"Katana",dmg:80,price:3e5,icon:"ğŸ—¡ï¸"},lazer:{name:"Lazer TabancasÄ±",dmg:150,price:1e6,icon:"ğŸ”«"}},s={tisort:{name:"YÄ±rtÄ±k TiÅŸÃ¶rt",def:0,hp:0,price:0,icon:"ğŸ‘•"},deri:{name:"Deri Ceket",def:5,hp:50,price:7500,icon:"ğŸ§¥"},yelek:{name:"Ã‡elik Yelek",def:15,hp:150,price:4e4,icon:"ğŸ¦º"},zirh:{name:"ÅÃ¶valye ZÄ±rhÄ±",def:30,hp:400,price:15e4,icon:"ğŸ›¡ï¸"},nano:{name:"Nano Suit",def:60,hp:1e3,price:5e5,icon:"ğŸ¤–"},kral:{name:"Kraliyet ZÄ±rhÄ±",def:100,hp:2500,price:2e6,icon:"ğŸ‘‘"}},c={"Ä°ÅŸsiz":{reward:0,icon:"ğŸ‘¤",req_edu:0,req_item:null},Dilenci:{reward:300,icon:"ğŸª£",req_edu:0,req_item:"YÄ±rtÄ±k Karton",price:50},"Mendil SatÄ±cÄ±sÄ±":{reward:350,icon:"ğŸ§»",req_edu:0,req_item:"Mendil Paketi",price:100},"Su SatÄ±cÄ±sÄ±":{reward:400,icon:"ğŸ’§",req_edu:0,req_item:"Su Kolisi",price:150},"Seyyar SatÄ±cÄ±":{reward:450,icon:"ğŸ¥’",req_edu:0,req_item:"El ArabasÄ±",price:250},"PazarcÄ±":{reward:500,icon:"ğŸ‹",req_edu:0,req_item:"Pazar TezgahÄ±",price:400},"Sokak MÃ¼zisyeni":{reward:550,icon:"ğŸ¸",req_edu:0,req_item:"Gitar",price:500},"KaÄŸÄ±t ToplayÄ±cÄ±":{reward:600,icon:"ğŸ¥¡",req_edu:0,req_item:"Ã‡ekÃ§ek",price:600},"SimitÃ§i":{reward:650,icon:"ğŸ¥¯",req_edu:0,req_item:"Simit Tepsisi",price:750},"BroÅŸÃ¼rcÃ¼":{reward:700,icon:"ğŸ“„",req_edu:0,req_item:"El Ä°lanlarÄ±",price:850},"BoyacÄ±":{reward:750,icon:"ğŸ‘",req_edu:0,req_item:"Boya SandÄ±ÄŸÄ±",price:1e3},"Oto YÄ±kamacÄ±":{reward:800,icon:"ğŸ§½",req_edu:0,req_item:"SÃ¼nger",price:1200},Hamal:{reward:850,icon:"ğŸ‹ï¸",req_edu:0,req_item:"SÄ±rtlÄ±k",price:1500},"Ã‡Ã¶pÃ§Ã¼":{reward:900,icon:"ğŸ§¹",req_edu:0,req_item:"SÃ¼pÃ¼rge",price:1800},"BulaÅŸÄ±kÃ§Ä±":{reward:1e3,icon:"ğŸ½ï¸",req_edu:0,req_item:"Eldiven",price:2e3},Amele:{reward:1100,icon:"ğŸ§±",req_edu:0,req_item:"Baret",price:2200},"Ã‡iftÃ§i":{reward:1150,icon:"ğŸšœ",req_edu:0,req_item:"Ã‡apa",price:2500},"BalÄ±kÃ§Ä±":{reward:1200,icon:"ğŸ£",req_edu:0,req_item:"Olta",price:3e3},Tezgahtar:{reward:2e3,icon:"ğŸ·ï¸",req_edu:1,req_item:"Yazar Kasa",price:4e3},"BekÃ§i":{reward:2150,icon:"ğŸ”¦",req_edu:1,req_item:"Fener",price:5e3},Vale:{reward:2300,icon:"ğŸ”‘",req_edu:1,req_item:"Vale KartÄ±",price:5500},"BahÃ§Ä±van":{reward:2450,icon:"ğŸŒ»",req_edu:1,req_item:"Budama MakasÄ±",price:6e3},"Garaj Sorumlusu":{reward:2600,icon:"ğŸ…¿ï¸",req_edu:1,req_item:"DÃ¼dÃ¼k",price:6500},Depocu:{reward:2800,icon:"ğŸ“¦",req_edu:1,req_item:"Transpalet",price:7e3},Kurye:{reward:3e3,icon:"ğŸ›µ",req_edu:1,req_item:"Eski Motor",price:8e3},"Market GÃ¶revlisi":{reward:3200,icon:"ğŸª",req_edu:1,req_item:"Maket BÄ±Ã§aÄŸÄ±",price:8500},Benzinci:{reward:3400,icon:"â›½",req_edu:1,req_item:"Pompa",price:9e3},"ÅofÃ¶r":{reward:3600,icon:"ğŸš•",req_edu:1,req_item:"Taksi PlakasÄ±",price:1e4},Kasiyer:{reward:3800,icon:"ğŸ’µ",req_edu:1,req_item:"Barkod Okuyucu",price:12e3},"TabelacÄ±":{reward:4e3,icon:"ğŸ—ï¸",req_edu:1,req_item:"FÄ±rÃ§a Seti",price:13e3},Terzi:{reward:4250,icon:"ğŸ§µ",req_edu:1,req_item:"DikiÅŸ Makinesi",price:14e3},"GÃ¼venlik":{reward:4750,icon:"ğŸ‘®",req_edu:2,req_item:"Telsiz",price:18e3},Bodyguard:{reward:5e3,icon:"ğŸ•¶ï¸",req_edu:2,req_item:"KulaklÄ±k",price:2e4},Garson:{reward:5250,icon:"â˜•",req_edu:2,req_item:"Ã–nlÃ¼k",price:22e3},"Makyaj Artisti":{reward:5500,icon:"ğŸ’„",req_edu:2,req_item:"Makyaj Ã‡antasÄ±",price:25e3},"KuafÃ¶r":{reward:5750,icon:"ğŸ’‡",req_edu:2,req_item:"FÃ¶n Makinesi",price:28e3},"Tattoo Artisti":{reward:6e3,icon:"âœ’ï¸",req_edu:2,req_item:"DÃ¶vme Makinesi",price:3e4},Berber:{reward:6250,icon:"âœ‚ï¸",req_edu:2,req_item:"Makas Seti",price:32e3},"Fitness EÄŸitmeni":{reward:6500,icon:"ğŸ’ª",req_edu:2,req_item:"Halter",price:35e3},Barista:{reward:6750,icon:"â˜•ï¸",req_edu:2,req_item:"Kahve Makinesi",price:38e3},DJ:{reward:7e3,icon:"ğŸ§",req_edu:2,req_item:"DJ Setup",price:4e4},"FotoÄŸrafÃ§Ä±":{reward:7250,icon:"ğŸ“¸",req_edu:2,req_item:"Kamera",price:45e3},Youtuber:{reward:7500,icon:"â–¶ï¸",req_edu:2,req_item:"YayÄ±ncÄ± EkipmanÄ±",price:5e4},Cankurtaran:{reward:8e3,icon:"ğŸ†˜",req_edu:2,req_item:"Can Simidi",price:55e3},"ElektrikÃ§i":{reward:1e4,icon:"âš¡",req_edu:3,req_item:"Kontrol Kalemi",price:7e4},"TesisatÃ§Ä±":{reward:10400,icon:"ğŸš°",req_edu:3,req_item:"Ä°ngiliz AnahtarÄ±",price:75e3},Marangoz:{reward:10800,icon:"ğŸªš",req_edu:3,req_item:"Testere",price:8e4},"HemÅŸire":{reward:11200,icon:"ğŸ’‰",req_edu:3,req_item:"ÅÄ±rÄ±nga",price:85e3},Sekreter:{reward:11600,icon:"ğŸ“",req_edu:3,req_item:"Telefon",price:9e4},"KÃ¼tÃ¼phaneci":{reward:12100,icon:"ğŸ“š",req_edu:3,req_item:"Barkod Okuyucu",price:95e3},Tamirci:{reward:12600,icon:"ğŸ”§",req_edu:3,req_item:"Alet Ã‡antasÄ±",price:1e5},Laborant:{reward:13100,icon:"ğŸ”¬",req_edu:3,req_item:"TÃ¼p",price:11e4},"TÄ±bbi Laboratuvar":{reward:13600,icon:"ğŸ§ª",req_edu:3,req_item:"MikrosantrifÃ¼j",price:12e4},"AÅŸÃ§Ä±":{reward:14100,icon:"ğŸ‘¨â€ğŸ³",req_edu:3,req_item:"AÅŸÃ§Ä± BÄ±Ã§aÄŸÄ±",price:125e3},"Kabin Memuru":{reward:14600,icon:"ğŸ’",req_edu:3,req_item:"UÃ§uÅŸ KartÄ±",price:13e4},"Ä°tfaiyeci":{reward:15100,icon:"ğŸš’",req_edu:3,req_item:"YangÄ±n TÃ¼pÃ¼",price:14e4},"GÃ¼mrÃ¼k Memuru":{reward:15600,icon:"ğŸ›‚",req_edu:3,req_item:"MÃ¼hÃ¼r",price:15e4},Polis:{reward:16100,icon:"ğŸ‘®â€â™‚ï¸",req_edu:3,req_item:"Silah RuhsatÄ±",price:18e4},Grafiker:{reward:16500,icon:"ğŸ¨",req_edu:3,req_item:"Ã‡izim Tableti",price:2e5},"EmlakÃ§Ä±":{reward:16900,icon:"ğŸ ",req_edu:3,req_item:"Ajanda",price:22e4},"DalgÄ±Ã§":{reward:17200,icon:"ğŸ¤¿",req_edu:3,req_item:"Oksijen TÃ¼pÃ¼",price:24e4},"KaynakÃ§Ä±":{reward:17500,icon:"ğŸ‘¨â€ğŸ­",req_edu:3,req_item:"Kaynak Maskesi",price:25e4},"BankacÄ±":{reward:21e3,icon:"ğŸ¦",req_edu:4,req_item:"Hesap Makinesi",price:35e4},Arkeolog:{reward:21500,icon:"ğŸº",req_edu:4,req_item:"FÄ±rÃ§a",price:37e4},Muhasebeci:{reward:22e3,icon:"ğŸ“‰",req_edu:4,req_item:"Mali MÃ¼hÃ¼r",price:4e5},Sosyolog:{reward:22500,icon:"ğŸ‘¥",req_edu:4,req_item:"Anket Formu",price:42e4},"Ã–ÄŸretmen":{reward:23e3,icon:"ğŸ‘¨â€ğŸ«",req_edu:4,req_item:"Kitap Seti",price:45e4},"Psikolojik DanÄ±ÅŸman":{reward:23500,icon:"ğŸ—£ï¸",req_edu:4,req_item:"Not Defteri",price:48e4},Gazeteci:{reward:24e3,icon:"ğŸ“°",req_edu:4,req_item:"Mikrofon",price:5e5},"YatÄ±rÄ±m UzmanÄ±":{reward:24500,icon:"ğŸ“ˆ",req_edu:4,req_item:"Borsa EkranÄ±",price:55e4},"EditÃ¶r":{reward:25e3,icon:"âœï¸",req_edu:4,req_item:"Laptop",price:6e5},"YazÄ±lÄ±mcÄ±":{reward:25500,icon:"ğŸ’»",req_edu:4,req_item:"YazÄ±lÄ±m LisansÄ±",price:75e4},Mimar:{reward:26e3,icon:"ğŸ“",req_edu:4,req_item:"Ã‡izim MasasÄ±",price:85e4},"MÃ¼hendis":{reward:26500,icon:"ğŸ‘·",req_edu:4,req_item:"MÃ¼hendislik DiplomasÄ±",price:1e6},Avukat:{reward:27e3,icon:"âš–ï¸",req_edu:4,req_item:"CÃ¼bbe",price:12e5},Diyetisyen:{reward:27500,icon:"ğŸ¥—",req_edu:4,req_item:"Diyet Listesi",price:14e5},"DenetÃ§i":{reward:28e3,icon:"ğŸ“",req_edu:4,req_item:"Audit DosyasÄ±",price:16e5},Biyolog:{reward:29e3,icon:"ğŸŒ¿",req_edu:4,req_item:"Petri KabÄ±",price:18e5},Psikolog:{reward:37500,icon:"ğŸ§ ",req_edu:5,req_item:"Terapi KoltuÄŸu",price:25e5},"Veri Bilimci":{reward:38500,icon:"ğŸ“Š",req_edu:5,req_item:"SÃ¼per Bilgisayar",price:28e5},"EczacÄ±":{reward:39500,icon:"ğŸ’Š",req_edu:5,req_item:"Laboratuvar Ã–nlÃ¼ÄŸÃ¼",price:3e6},"Yapay Zeka MÃ¼hendisi":{reward:40500,icon:"ğŸ¤–",req_edu:5,req_item:"GPU Server",price:35e5},Veteriner:{reward:41500,icon:"ğŸ¾",req_edu:5,req_item:"Stetoskop",price:4e6},"Genetik MÃ¼hendisi":{reward:42500,icon:"ğŸ§¬",req_edu:5,req_item:"DNA Kiti",price:5e6},Doktor:{reward:44e3,icon:"ğŸ©º",req_edu:5,req_item:"TÄ±p DiplomasÄ±",price:8e6},"DiÅŸ Hekimi":{reward:45e3,icon:"ğŸ¦·",req_edu:5,req_item:"DiÅŸÃ§i KoltuÄŸu",price:9e6},"BaÅŸhekim":{reward:46e3,icon:"ğŸ¥",req_edu:5,req_item:"BaÅŸhekim KaÅŸesi",price:1e7},Pilot:{reward:47e3,icon:"âœˆï¸",req_edu:5,req_item:"Pilot LisansÄ±",price:25e5},"SavcÄ±":{reward:48e3,icon:"ğŸ›ï¸",req_edu:5,req_item:"Kanun KitabÄ±",price:3e6},Hakim:{reward:49e3,icon:"ğŸ”¨",req_edu:5,req_item:"Tokmak",price:35e5},"UÃ§uÅŸ MÃ¼hendisi":{reward:49500,icon:"ğŸ›«",req_edu:5,req_item:"UÃ§uÅŸ Manueli",price:4e6},"Siber GÃ¼venlik UzmanÄ±":{reward:5e4,icon:"ğŸ›¡ï¸",req_edu:5,req_item:"Åifreleme KartÄ±",price:5e6},Cerrah:{reward:75e3,icon:"ğŸ¥",req_edu:6,req_item:"NeÅŸter",price:75e5},"RektÃ¶r":{reward:8e4,icon:"ğŸ“",req_edu:6,req_item:"RektÃ¶rlÃ¼k MÃ¼hrÃ¼",price:85e5},"BÃ¼yÃ¼kelÃ§i":{reward:85e3,icon:"ğŸŒ",req_edu:6,req_item:"Diplomat Pasaportu",price:1e7},"Orkestra Åefi":{reward:9e4,icon:"ğŸ¼",req_edu:6,req_item:"Baton",price:125e5},"Bilim Ä°nsanÄ±":{reward:1e5,icon:"ğŸ§ª",req_edu:6,req_item:"Mikroskop",price:15e6},"YÃ¶netmen":{reward:11e4,icon:"ğŸ¬",req_edu:6,req_item:"Klaket",price:2e7},"NÃ¼kleer FizikÃ§i":{reward:115e3,icon:"âš›ï¸",req_edu:6,req_item:"Radyasyon Ã–lÃ§er",price:25e6},"Uzay MÃ¼hendisi":{reward:125e3,icon:"ğŸ›°ï¸",req_edu:6,req_item:"Uydu AlÄ±cÄ±sÄ±",price:35e6},Astronot:{reward:175e3,icon:"ğŸš€",req_edu:7,req_item:"Uzay MekiÄŸi Bileti",price:4e7},CEO:{reward:19e4,icon:"ğŸ‘”",req_edu:7,req_item:"Åirket Hissesi",price:5e7},Milletvekili:{reward:205e3,icon:"ğŸ›ï¸",req_edu:7,req_item:"Mazbata",price:6e7},"Devlet BaÅŸkanÄ±":{reward:22e4,icon:"ğŸ‘‘",req_edu:7,req_item:"Kral TacÄ±",price:75e6},"DÃ¼nya BankasÄ± BaÅŸkanÄ±":{reward:235e3,icon:"ğŸ’¸",req_edu:7,req_item:"AltÄ±n Kasa",price:85e6},"Kripto KralÄ±":{reward:25e4,icon:"ğŸ’",req_edu:7,req_item:"SoÄŸuk CÃ¼zdan",price:1e8}},d={colors:[{id:"gold",name:"AltÄ±n SarÄ±sÄ±",color:"#FFD700",price:5e4,type:"name"},{id:"neon",name:"Neon YeÅŸil",color:"#39FF14",price:3e4,type:"name"},{id:"ruby",name:"Yakut KÄ±rmÄ±zÄ±sÄ±",color:"#E0115F",price:4e4,type:"name"},{id:"royal",name:"Kraliyet Mavisi",color:"#4169E1",price:4e4,type:"name"},{id:"violet",name:"Lavanta Moru",color:"#EE82EE",price:35e3,type:"name"}],backgrounds:[{id:"dark_glass",name:"KaranlÄ±k Cam",style:"background: rgba(10,10,10,0.85); backdrop-filter: blur(20px);",price:25e3},{id:"midnight",name:"Gece Mavisi",style:"background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);",price:1e5},{id:"toxic",name:"Toksik Radyasyon",style:"background: radial-gradient(circle at center, #1a4a1a 0%, #0a0a0a 100%);",price:15e4},{id:"sunset",name:"GÃ¼n BatÄ±mÄ±",style:"background: linear-gradient(45deg, #ee0979, #ff6a00); opacity: 0.9;",price:2e5},{id:"cyber",name:"Siber Punk",style:"background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%); border-color: #00d2ff;",price:3e5},{id:"rainbow",name:"GÃ¶kkuÅŸaÄŸÄ± (Hareketli)",style:"background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); background-size: 400% 400%; animation: gradient 15s ease infinite;",price:5e5}]};let l=null,m=null;const p=[{cmd:"!market",desc:"Market linkini sohbete atar."},{cmd:"!bakiye",desc:"Mevcut paranÄ±zÄ± gÃ¶sterir."},{cmd:"!yazitura <miktar> <y/t>",desc:"YazÄ± tura atar (x2 kazanÃ§)."},{cmd:"!slot <miktar>",desc:"Slot makinesini Ã§evirir."},{cmd:"!kutu <miktar> <1-3>",desc:"Kutu aÃ§ma oyunu (1, 2 veya 3)."},{cmd:"!zenginler",desc:"En zengin ilk 5 kiÅŸiyi listeler."},{cmd:"!transfer @kisi <miktar>",desc:"ArkadaÅŸÄ±na para gÃ¶nderir."},{cmd:"!duello @kisi <miktar>",desc:"Bahisli dÃ¼ello teklif eder."},{cmd:"!kabul",desc:"Gelen dÃ¼ello teklifini kabul eder."},{cmd:"!reddet",desc:"Gelen dÃ¼ello teklifini reddeder."},{cmd:"!rusruleti @kisi <miktar>",desc:"Rus ruleti teklif eder (timeout riski)."},{cmd:"!ruskabul",desc:"Rus ruleti teklifini kabul eder."},{cmd:"!soygun",desc:"Kanalda soygun baÅŸlatÄ±r veya katÄ±l."},{cmd:"!profil",desc:"DetaylÄ± profilinizi gÃ¶sterir."},{cmd:"!meslek",desc:"Mevcut mesleÄŸinizi gÃ¶sterir."},{cmd:"!calis",desc:"Ã‡alÄ±ÅŸÄ±p maaÅŸ alÄ±rsÄ±nÄ±z (30dk sÃ¼re)."},{cmd:"!fal",desc:"GÃ¼nÃ¼n falÄ±na bakar."},{cmd:"!burÃ§ <burÃ§>",desc:"GÃ¼nlÃ¼k burÃ§ yorumu."},{cmd:"!efkar",desc:"Efkar seviyenizi Ã¶lÃ§er."},{cmd:"!sÃ¶z",desc:"GÃ¼nÃ¼n sÃ¶zÃ¼nÃ¼ paylaÅŸÄ±r."},{cmd:"!ÅŸarkÄ±Ã¶ner",desc:"Rastgele ÅŸarkÄ± Ã¶nerir."},{cmd:"!8top <soru>",desc:"Sihirli 8 top cevaplar."},{cmd:"!iq",desc:"IQ seviyenizi Ã¶lÃ§er."},{cmd:"!ÅŸans",desc:"GÃ¼nlÃ¼k ÅŸans Ã¶lÃ§er."},{cmd:"!kiÅŸilik",desc:"KiÅŸilik analizi yapar."},{cmd:"!zar",desc:"Ä°ki zar atar."},{cmd:"!Ä±rk",desc:"Genetik Ä±rk analizi."},{cmd:"!ship <ops:kisi>",desc:"AÅŸk uyumu Ã¶lÃ§er."},{cmd:"!hava <ÅŸehir>",desc:"Hava durumunu gÃ¶sterir."},{cmd:"!troll <salla/bsod/glitch>",desc:"YayÄ±ncÄ±yÄ± troller (Ãœcretli)."},{cmd:"!hangisi <A> mÄ± <B> mi",desc:"Bot bir seÃ§im yapar."}];let u=null,y=null;function g(){const e=document.getElementById("commands-grid");e&&(e.innerHTML="",p.forEach(n=>{const t=document.createElement("div");t.className="item-card",t.style.padding="15px",t.innerHTML=`\n            <div style="display:flex; justify-content:space-between; align-items:flex-start;">\n                <code style="color:var(--primary); font-weight:bold; font-size:0.95rem;">${n.cmd}</code>\n            </div>\n            <p style="margin:8px 0 0 0; color:#aaa; font-size:0.85rem;">${n.desc}</p>\n        `,e.appendChild(t)}))}async function f(){const e=document.getElementById("devlog-content");if(e)try{const n=await fetch("/api/announcements"),t=await n.json();if(!t||0===t.length)return void(e.innerHTML='<div style="color:#666; font-size:0.8rem;">HenÃ¼z duyuru yok.</div>');e.innerHTML="",t.slice(0,10).forEach(n=>{const t=new Date(n.timestamp).toLocaleDateString("tr-TR",{day:"numeric",month:"short"}),a=`badge-${n.type||"info"}`,i=document.createElement("div");i.className=`announcement-item ${a}`,i.innerHTML=`\n                <div class="ann-header">\n                    <span class="ann-type">${n.type||"info"}</span>\n                    <span class="ann-date">${t}</span>\n                </div>\n                <div class="ann-text">${n.text}</div>\n            `,e.appendChild(i)})}catch(n){console.error("Devlog yÃ¼kleme hatasÄ±:",n),e.innerHTML='<div style="color:#666; font-size:0.8rem;">Duyurular yÃ¼klenemedi.</div>'}}function b(e){const n=document.getElementById("devlog-sidebar"),t=document.getElementById("devlog-toggle-btn");n&&t&&(e?(n.classList.remove("collapsed"),t.classList.add("hidden"),localStorage.setItem("devlog_visible","true")):(n.classList.add("collapsed"),t.classList.remove("hidden"),localStorage.setItem("devlog_visible","false")))}async function v(){if(console.log("Waiting for Firebase..."),!await n)return console.error("Database not ready!"),N("VeritabanÄ± baÄŸlantÄ±sÄ± kurulamadÄ±. Yenileniyor...","error"),void setTimeout(()=>window.location.reload(),3e3);console.log("Market initialized");const t=localStorage.getItem("aloskegang_user");g(),f(),b("false"!==localStorage.getItem("devlog_visible")),t?z(t):h();const a=document.getElementById("generate-code-btn");a&&(a.replaceWith(a.cloneNode(!0)),document.getElementById("generate-code-btn").addEventListener("click",k));const i=document.getElementById("back-btn");i&&i.addEventListener("click",h);const r=document.getElementById("logout-btn");r&&r.addEventListener("click",j),e.ref("system/force_logout").on("value",e=>{const n=e.val();n&&n>(localStorage.getItem("last_processed_logout")||0)&&(console.log("FORCE LOGOUT RECEIVED"),localStorage.setItem("last_processed_logout",n),l&&(j(),N("Admin tarafÄ±ndan Ã§Ä±kÄ±ÅŸ yaptÄ±rÄ±ldÄ±.","warning")))})}function h(){const e=document.getElementById("auth-container"),n=document.getElementById("main-content"),t=document.getElementById("step-1"),a=document.getElementById("step-2");e&&e.classList.remove("hidden"),n&&n.classList.add("hidden"),t&&t.classList.remove("hidden"),a&&a.classList.add("hidden"),window.authPoller&&(clearInterval(window.authPoller),window.authPoller=null)}function k(){const e=document.getElementById("username-input").value.toLowerCase().trim();if(e.length<3)return N("GeÃ§ersiz kullanÄ±cÄ± adÄ±!","error");if(/[.#$\[\]]/.test(e))return N("KullanÄ±cÄ± adÄ± geÃ§ersiz karakterler iÃ§eriyor!","error");const n=document.getElementById("auth-code"),t=document.getElementById("cmd-example"),a=document.getElementById("step-1"),i=document.getElementById("step-2");N("Kod oluÅŸturuluyor...","info"),fetch("/api/auth/generate-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})}).then(e=>e.json()).then(r=>{if(!r.success)return void N(r.error||"Kod oluÅŸturulamadÄ±!","error");const o=r.code;n&&(n.innerText=o),t&&(t.innerText=`!doÄŸrulama ${o}`),a&&a.classList.add("hidden"),i&&i.classList.remove("hidden"),console.log(`[Shop] Auth code generated for ${e}: ${o}`),N("Kod oluÅŸturuldu! Twitch'te komutu yaz.","success");let s=0;const c=setInterval(async()=>{if(s++,s>120)return clearInterval(c),N("DoÄŸrulama sÃ¼resi doldu. Tekrar deneyin.","warning"),a&&a.classList.remove("hidden"),void(i&&i.classList.add("hidden"));try{const n=await fetch(`/api/auth/check/${e}`),t=await n.json();t.authenticated&&(clearInterval(c),t.token&&localStorage.setItem("aloskegang_token",t.token),z(e),N("GiriÅŸ BaÅŸarÄ±lÄ±! HoÅŸ geldin.","success"))}catch(e){console.error("Auth polling error:",e)}},1e3);window.authPoller=c}).catch(e=>{console.error("Auth API Error:",e),N("Sunucu baÄŸlantÄ± hatasÄ±!","error"),a&&a.classList.remove("hidden"),i&&i.classList.add("hidden")})}function x(){return(new Date).toLocaleDateString("en-CA",{timeZone:"Europe/Istanbul"})}async function w(){if(S)return S;if(!l)return{};try{const n=(await e.ref("users/"+l).once("value")).val();if(n)return n}catch(e){}try{const e=await fetch("/api/user/"+l,{headers:{Authorization:`Bearer ${localStorage.getItem("aloskegang_token")}`}}),n=await e.json();if(n&&!n.error)return n}catch(e){}return{}}async function $(e){try{const n=document.getElementById("user-pfp"),t=document.getElementById("user-pfp-fallback"),a=await fetch(`/api/kick/pfp/${e}`);if(!a.ok)throw new Error("PFP API error");const i=await a.json();i.pfp&&n&&(n.src=i.pfp,n.onload=()=>{n.style.display="block",t&&(t.style.display="none")})}catch(e){}}function z(n){l=n,localStorage.setItem("aloskegang_user",n),localStorage.getItem("last_processed_logout")||localStorage.setItem("last_processed_logout",Date.now()),localStorage.setItem("last_processed_logout",Date.now());const t=document.getElementById("auth-container"),a=document.getElementById("main-content");t&&t.classList.add("hidden"),a&&a.classList.remove("hidden");const i=document.getElementById("display-name"),r=document.getElementById("hero-name");i&&(i.innerText=n.toUpperCase()),r&&(r.innerText=n.toUpperCase());const o=document.getElementById("user-pfp-fallback");o&&(o.innerText=n[0].toUpperCase()),$(n),e.ref("users/"+n).on("value",e=>{const n=e.val();n&&_(n)}),fetch("/api/user/"+n).then(e=>e.json()).then(e=>{e&&!e.error&&_(e)}).catch(e=>console.log("User API fetch failed:",e)),setTimeout(()=>E("market"),100)}window.addEventListener("DOMContentLoaded",v);let S=null;function _(e){if(!e)return;S=e;const n=document.getElementById("user-balance");if(n&&(e.is_infinite?(n.innerText="Omega'nÄ±n KartÄ± ğŸ’³â™¾ï¸",n.style.background="linear-gradient(135deg, #FFD700, #FFA500)",n.style.color="#000"):(n.innerText=`${(e.balance||0).toLocaleString()} ğŸ’°`,n.style.background="",n.style.color="")),e.auth_channel&&e.auth_channel!==m)m=e.auth_channel,A(m);else if(!e.auth_channel){const e=document.getElementById("no-channel-msg"),n=document.getElementById("market-items"),t=document.getElementById("channel-badge"),a=document.getElementById("market-status");e&&e.classList.remove("hidden"),n&&(n.innerHTML=""),t&&t.classList.add("hidden"),a&&(a.innerText="Market Ã¼rÃ¼nlerini gÃ¶rmek iÃ§in herhangi bir kanalda !doÄŸrulama yapmalÄ±sÄ±n.")}ue()}async function A(n){document.getElementById("no-channel-msg").classList.add("hidden");const t=document.getElementById("channel-badge");t&&t.classList.remove("hidden");const a=(await e.ref("channels/"+n).once("value")).val()||{},i=a.settings||{},r=i.custom_sounds||{},o=a.username||"Kick KanalÄ±";document.getElementById("chan-name").innerText=o;try{const e=document.getElementById("chan-pfp"),n=document.getElementById("chan-pfp-fallback"),t=await fetch(`/api/kick/pfp/${o}`);if(!t.ok)throw new Error("PFP error");const a=await t.json();if(!a.pfp)throw new Error("No pfp data");e.src=a.pfp,e.onload=()=>{e.style.display="block",n&&(n.style.display="none")},e.onerror=()=>{e.style.display="none",n&&(n.style.display="flex")}}catch(e){console.log("Broadcaster PFP error",e);const n=document.getElementById("chan-pfp"),t=document.getElementById("chan-pfp-fallback");n&&(n.style.display="none"),t&&(t.innerText=o[0].toUpperCase(),t.style.display="flex")}const s="https://media.giphy.com/media/3o7TKMGpxPucV0G3S0/giphy.gif",c=e=>e?e.startsWith("http")?e:`/${e}`:s,d=c(i.left_gif),l=c(i.right_gif),m=document.querySelector(".side-gif.left img"),p=document.querySelector(".side-gif.right img");m&&(m.src=d,m.onerror=()=>{m.src=s}),p&&(p.src=l,p.onerror=()=>{p.src=s}),document.getElementById("market-status").innerText=`${o} market Ã¼rÃ¼nleri yÃ¶netiliyor.`;const u=document.getElementById("market-items");u&&(u.innerHTML="");const y=e=>!1!==i[e];q("ğŸš« KullanÄ±cÄ± Sustur","Hedeflenen kiÅŸiyi 2 dakika boyunca susturur.",i.mute_cost||1e4,"mute","","",0,!y("sustur")),q("ğŸ™ï¸ TTS (Sesli Mesaj)","MesajÄ±nÄ±zÄ± yayÄ±nda farklÄ± seslerle seslendirir. (Maks 500 karakter)",i.tts_cost||2500,"tts","","",0,!y("tts")),q("ğŸµ ÅarkÄ± Ä°steÄŸi (!sr)","YouTube'dan istediÄŸiniz ÅŸarkÄ±yÄ± aÃ§ar.",i.sr_cost||5e3,"sr","","",0,!y("sr")),Object.entries(r).forEach(([e,n])=>{q(`ğŸµ Ses: !ses ${e}`,"Kanalda Ã¶zel ses efekti Ã§alar.",n.cost,"sound",e,n.url,n.duration||0,!y("ses"))})}function q(e,n,t,a,i="",r="",o=0,s=!1){const c=document.getElementById("market-items");if(!c)return;const d=document.createElement("div");d.className="item-card "+(s?"disabled":"");const l="tts"===a?"ğŸ™ï¸":"mute"===a?"ğŸš«":"sr"===a?"ğŸµ":"ğŸ¼";d.innerHTML=`\n        <div style="display:flex; justify-content:space-between; align-items:flex-start;">\n            <div class="item-icon">${l}</div>\n            ${"sound"!==a||s?"":`\n                <div style="display:flex; gap:10px;">\n                    <button onclick="previewShopSound('${r}', ${o})" style="background:none; border:none; color:var(--primary); cursor:pointer; font-size:1.5rem; padding:0;">â–¶ï¸</button>\n                    <button onclick="stopAllPreviews()" style="background:none; border:none; color:var(--danger); cursor:pointer; font-size:1.5rem; padding:0;">â¹ï¸</button>\n                </div>\n            `}\n            ${s?'<span class="disabled-label">DEVREDIÅI</span>':""}\n        </div>\n        <h3>${e}</h3>\n        <p>${n}</p>\n        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">\n            <span class="price-tag" style="margin:0;">${parseInt(t).toLocaleString()} ğŸ’°</span>\n            ${o>0?`<small style="color:#666">${o}sn</small>`:""}\n        </div>\n        <button class="buy-btn" ${s?"disabled":""} onclick="executePurchase('${a}', '${i}', ${t})">\n            ${s?"KapalÄ±":"Hemen Uygula"}\n        </button>\n    `,c.appendChild(d)}function T(e,n){K(),u=new Audio(e),u.volume=.5,u.play().catch(e=>console.error("Ã–nizleme hatasÄ±:",e)),n>0&&(y=setTimeout(()=>{K()},1e3*n))}function K(){u&&(u.pause(),u.currentTime=0,u=null),y&&(clearTimeout(y),y=null)}async function O(e,n,t){if(!l||!m)return;const a=await w();if(a.balance||(a.balance=0),!a.is_infinite&&(a.balance||0)<t)return N("Bakiye yetersiz! âŒ","error");let i="";if("tts"!==e){if("mute"===e){if(i=await Te("KullanÄ±cÄ± Sustur","Susturulacak kullanÄ±cÄ±nÄ±n adÄ±nÄ± girin:","Ã–rn: aloske"),!i)return;i=i.replace("@","").toLowerCase().trim()}else if("sr"===e){if(i=await Te("ÅarkÄ± Ä°steÄŸi","YouTube Video Linkini YapÄ±ÅŸtÄ±rÄ±n:","https://youtube.com/..."),!i)return;if(!i.includes("youtube.com")&&!i.includes("youtu.be"))return void await qe("Hata","LÃ¼tfen geÃ§erli bir YouTube linki girin!")}try{const t={username:l,channelId:m,type:e,data:{}};"sound"===e&&(t.data={trigger:n}),"mute"===e&&(t.data={target:i}),"sr"===e&&(t.data={url:i});const a=await fetch("/api/market/buy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("aloskegang_token")}`},body:JSON.stringify(t)}),r=await a.json();r.success?(N(r.message,"success"),X()):N(r.error||"Hata oluÅŸtu!","error")}catch(e){console.error(e),N("Sunucu ile iletiÅŸim hatasÄ±.","error")}}else M(t)}function M(e){const n=document.getElementById("tts-modal");n.classList.remove("hidden"),n.style.display="flex",document.getElementById("tts-input").value="",document.getElementById("confirm-tts-buy").onclick=()=>B(e)}function I(){const e=document.getElementById("tts-modal");e.classList.add("hidden"),e.style.display="none"}async function B(e){const n=document.getElementById("tts-input").value.trim(),t=document.getElementById("tts-voice-select").value;if(!n)return N("Mesaj boÅŸ olamaz!","error");if(n.length>500)return N("Mesaj Ã§ok uzun!","error");const a=await w();if(!a.is_infinite&&(a.balance||0)<e)return N("Bakiye yetersiz! âŒ","error");try{const e=await fetch("/api/market/buy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("aloskegang_token")}`},body:JSON.stringify({username:l,channelId:m,type:"tts",data:{text:n,voice:t}})}),a=await e.json();a.success?(N("TTS MesajÄ±n yayÄ±na gÃ¶nderildi! ğŸ™ï¸","success"),I(),X()):N(a.error||"Ä°ÅŸlem baÅŸarÄ±sÄ±z.","error")}catch(e){console.error(e),N("Sunucu hatasÄ±!","error")}}function j(){localStorage.removeItem("aloskegang_user"),localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(e=>{document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}),location.reload()}function N(e,n){const t=document.getElementById("toast");t&&(t.innerText=e,t.className=`toast ${n}`,t.classList.remove("hidden"),setTimeout(()=>t.classList.add("hidden"),3e3))}function E(e){if(document.querySelectorAll(".tab-content").forEach(e=>e.classList.add("hidden")),document.getElementById("tab-"+e).classList.remove("hidden"),document.querySelectorAll(".tab-btn").forEach(e=>e.classList.remove("active")),"undefined"!=typeof event&&event&&event.currentTarget)event.currentTarget.classList.add("active");else{const n=document.querySelector(`.tab-btn[onclick*="switchTab('${e}')"]`);n&&n.classList.add("active")}"leaderboard"===e&&J(),"borsa"===e&&L(),"emlak"===e&&pe(),"quests"===e&&V(),"profile"===e&&X(),"career"===e&&ue(),"stats"===e&&$e(),"gangs"===e&&Q(),"business"===e&&dn(),"marketplace"===e&&vn()}let D=!1,R={};function P(e,n,t){if(!e||!n||n.length<2)return;const a=e.getContext("2d"),i=e.width,r=e.height,o=i-45;a.clearRect(0,0,i,r);const s=Math.min(...n),c=Math.max(...n),d=c-s||1;a.beginPath(),a.strokeStyle="rgba(255,255,255,0.03)",a.lineWidth=1,[.1,.5,.9].forEach(e=>{a.moveTo(0,r*e),a.lineTo(o,r*e)}),a.stroke(),a.beginPath(),a.strokeStyle=1===t?"#05ea6a":"#ff4d4d",a.lineWidth=2,a.lineJoin="round",n.forEach((e,t)=>{const i=t/(n.length-1)*o,c=r-(e-s)/d*r*.8-.1*r;0===t?a.moveTo(i,c):a.lineTo(i,c)}),a.stroke(),a.lineTo(o,r),a.lineTo(0,r);const l=a.createLinearGradient(0,0,0,r);l.addColorStop(0,1===t?"rgba(5,234,106,0.1)":"rgba(255,77,77,0.1)"),l.addColorStop(1,"transparent"),a.fillStyle=l,a.fill(),[{v:c,y:.1*r},{v:(c+s)/2,y:.5*r},{v:s,y:.9*r}].forEach(e=>{a.fillStyle="rgba(0,0,0,0.3)",a.fillRect(o+2,e.y-7,41,14),a.fillStyle="#888",a.font="bold 9px monospace",a.textAlign="center",a.fillText(Math.round(e.v).toLocaleString(),o+22.5,e.y+3),a.beginPath(),a.setLineDash([5,5]),a.strokeStyle="rgba(255,255,255,0.05)",a.moveTo(0,e.y),a.lineTo(o,e.y),a.stroke(),a.setLineDash([])})}async function L(){const n=document.getElementById("borsa-items");if(n&&!D){if(D=!0,l&&"omegacyr"===l.toLowerCase()){let e=document.getElementById("borsa-admin-actions");e||(e=document.createElement("div"),e.id="borsa-admin-actions",e.style.marginBottom="20px",e.style.display="flex",e.style.gap="10px",n.parentElement.insertBefore(e,n)),e.innerHTML="";const t=document.createElement("button");t.innerHTML="ğŸš¨ SIFIRLA",t.className="primary-btn",t.style.background="#ff4d4d",t.style.color="white",t.style.flex="1",t.onclick=async()=>{if(!await Ke("âš ï¸ Borsa SÄ±fÄ±rlama","TÃ¼m kullanÄ±cÄ±larÄ±n tÃ¼m hisselerini silmek istediÄŸine emin misin?"))return;const e=await fetch("/api/borsa/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requester:"omegacyr"})}),n=await e.json();n.success&&N(n.message,"success")};const a=document.createElement("button");a.innerHTML="ğŸ”§ EKSÄ°K MALÄ°YET VERÄ°LERÄ°NÄ° ONAR",a.className="primary-btn",a.style.background="#ff9f43",a.style.color="white",a.style.flex="1",a.onclick=async()=>{if(!await Ke("ğŸ”§ Maliyet DÃ¼zelt","Eksik maliyet verisi olan hisseler iÃ§in GÃœNCEL FÄ°YAT baz alÄ±narak maliyet eklenecek. OnaylÄ±yor musun?"))return;const e=await fetch("/api/borsa/fix-costs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requester:"omegacyr"})}),n=await e.json();n.success?N(n.message,"success"):N(n.error,"error")},e.appendChild(t),e.appendChild(a)}n.innerHTML='<div style="text-align:center; width:100%; padding:60px;"><div class="loader"></div><p style="margin-top:10px;">Borsa verileri yÃ¼kleniyor...</p></div>',e.ref("global_stocks").on("value",e=>{e.exists()&&(e=>{if(!e)return;if(window.shopStocks=e,e.error)return void(n.innerHTML=`<div class="error-box">${e.error}</div>`);const t=Object.entries(e);let a=document.getElementById("market-cycle-status");a||(n.innerHTML="",a=document.createElement("div"),a.id="market-cycle-status",a.style="grid-column: 1 / -1; background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--glass-border); text-align: center;",n.appendChild(a));const i=t[0][1].marketStatus||"NORMAL",r={BULLISH:{t:"BOÄA PÄ°YASASI (YÃœKSELÄ°Å)",c:"#05ea6a"},BEARISH:{t:"AYI PÄ°YASASI (DÃœÅÃœÅ)",c:"#ff4d4d"},VOLATILE:{t:"YÃœKSEK VOLATÄ°LÄ°TE (RÄ°SKLÄ°)",c:"#ffaa00"},STAGNANT:{t:"DURGUN PÄ°YASA (YATAY)",c:"#888"},CRASH:{t:"âš ï¸ KRÄ°Z: BÃœYÃœK Ã‡Ã–KÃœÅ!",c:"red"},NORMAL:{t:"NORMAL PÄ°YASA",c:"#aaa"}};a.innerHTML=`<small style="color:#666; display:block; margin-bottom:4px;">GÃœNCEL EKONOMÄ°K DURUM</small><strong style="color:${r[i].c}; font-size:1.1rem; letter-spacing:1px;">${r[i].t}</strong>`,t.forEach(([e,t])=>{if(!t||"object"!=typeof t)return;if("status"===e)return;let a=t.oldPrice;t.history&&t.history.length>0&&(a=t.history[0]);const i=(t.price-a)/a*100,r=i.toFixed(2),o=i>=0?"ğŸ“ˆ":"ğŸ“‰",s=i>=0?"#05ea6a":"#ff4d4d";let c=document.querySelector(`.borsa-card[data-code="${e}"]`);if(c){const n=c.querySelector(".trend-val"),a=c.querySelector(".price-val"),d=c.querySelector(".btn-buy-main"),l=c.querySelector(".btn-sell-main");n.innerHTML=`${i>0?"+":""}${r}% ${o}`,n.style.color=s,a.innerHTML=`${(t.price||0).toLocaleString()} <span style="font-size:0.8rem; color:var(--primary);">ğŸ’°</span>`,d.onclick=()=>H(e,t.price),l.onclick=()=>Y(e,t.price)}else c=document.createElement("div"),c.className="item-card borsa-card",c.setAttribute("data-code",e),c.innerHTML=`\n                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">\n                        <div style="display:flex; flex-direction:column;">\n                            <span style="font-weight:800; font-size:1.1rem; color:var(--primary);">${e}</span>\n                            ${t.name?`<span style="font-size:0.75rem; color:#888;">${t.name}</span>`:""}\n                        </div>\n                        <span class="trend-val" style="color:${s}; font-weight:800; font-size:0.75rem;">\n                            ${i>0?"+":""}${r}% ${o}\n                        </span>\n                    </div>\n                    \n                    <div style="font-size:0.6rem; color:#666; margin-bottom:4px; text-transform:uppercase; letter-spacing:1px;">Son 24-48 Saatlik Grafik</div>\n                    <canvas id="chart-${e}" width="200" height="60" style="width:100%; height:60px; margin:5px 0;"></canvas>\n\n                    <div class="price-val" style="font-size:1.5rem; font-weight:800; color:white; margin:10px 0;">\n                        ${(t.price||0).toLocaleString()} <span style="font-size:0.8rem; color:var(--primary);">ğŸ’°</span>\n                    </div>\n\n                    <div style="font-size: 0.65rem; color: #ff4d4d; margin-bottom: 8px; font-weight: 600;">âš ï¸ %10 SatÄ±ÅŸ Komisyonu UygulanÄ±r</div>\n\n                    \x3c!-- AnlÄ±k Fiyat GÃ¶sterimi --\x3e\n                    <div id="price-calc-${e}" style="font-size:0.75rem; margin-bottom:10px; padding:8px; background:rgba(0,0,0,0.3); border-radius:8px; display:none;">\n                        <div style="display:flex; justify-content:space-between; color:#aaa;">\n                            <span>ğŸ“ˆ AlÄ±ÅŸ:</span>\n                            <span id="buy-price-${e}" style="color:var(--primary); font-weight:700;">-</span>\n                        </div>\n                        <div style="display:flex; justify-content:space-between; color:#aaa; margin-top:4px;">\n                            <span>ğŸ“‰ SatÄ±ÅŸ (-10%):</span>\n                            <span id="sell-price-${e}" style="color:#ff6b6b; font-weight:700;">-</span>\n                        </div>\n                    </div>\n\n                    <div class="borsa-controls" style="margin-top:10px;">\n                        <input type="number" id="input-${e}" class="borsa-input" value="1" min="0.00000001" step="any" placeholder="Adet" aria-label="${e} Adet SatÄ±n Al/Sat" oninput="updateBorsaPrice('${e}', ${t.price})">\n                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">\n                            <button class="buy-btn btn-buy-main" onclick="executeBorsaBuy('${e}', ${t.price})" style="background:var(--primary); color:black; font-weight:800; padding:8px;">AL</button>\n                            <button class="buy-btn btn-sell-main" onclick="executeBorsaSell('${e}', ${t.price})" style="background:rgba(255,255,255,0.05); color:white; border:1px solid var(--glass-border); padding:8px;">SAT</button>\n                        </div>\n                    </div>\n                `,n.appendChild(c);const d=[...t.history||[]];t.price&&d.push(t.price),P(document.getElementById(`chart-${e}`),d,t.trend),C(e,t.price)})})(e.val())}),e.ref("global_news").limitToLast(10).on("value",e=>{e.exists()&&G(e.val())})}}function G(e){const n=document.getElementById("news-ticker-container");if(!n)return;n.innerHTML="";const t=document.getElementById("news-date-display"),a=document.getElementById("news-last-update"),i=new Date;t&&(t.textContent=i.toLocaleDateString("tr-TR",{day:"numeric",month:"long",year:"numeric"})),a&&(a.textContent=i.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}));const r=Object.values(e).sort((e,n)=>n.timestamp-e.timestamp);0!==r.length?r.forEach((e,t)=>{const a=new Date(e.timestamp).toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}),i="GOOD"===e.type,r=0===t&&Date.now()-e.timestamp<3e5,o=document.createElement("div");o.className="news-item"+(r?" breaking":""),o.innerHTML=`\n            <div class="news-time">${a}</div>\n            <div class="news-content">\n                <div class="news-indicator ${i?"good":"bad"}">\n                    <span class="news-indicator-dot"></span>\n                    ${i?"ğŸ“ˆ YÃœKSELÄ°Å":"ğŸ“‰ DÃœÅÃœÅ"}\n                </div>\n                <div class="news-headline">${e.text}</div>\n            </div>\n        `,n.appendChild(o)}):n.innerHTML='\n            <div class="news-empty">\n                <i class="fas fa-newspaper"></i>\n                HenÃ¼z piyasa haberi yok...\n            </div>\n        '}function C(e,n){const t=document.getElementById(`input-${e}`),a=document.getElementById(`price-calc-${e}`),i=document.getElementById(`buy-price-${e}`),r=document.getElementById(`sell-price-${e}`);if(!(t&&a&&i&&r))return;const o=parseFloat(t.value.replace(",","."));if(!o||isNaN(o)||o<=0)return void(a.style.display="none");a.style.display="block";const s=Math.floor(n*o),c=Math.floor(n*o),d=Math.floor(.9*c);i.textContent=s.toLocaleString()+" ğŸ’°",r.textContent=d.toLocaleString()+" ğŸ’°"}async function H(e,n){if(!l)return;const t=document.getElementById(`input-${e}`),a=parseFloat(t.value.replace(",","."));if(!a||isNaN(a)||a<=0)return N("GeÃ§ersiz miktar!","error");try{const n=await fetch("/api/borsa/buy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,code:e,amount:a})}),t=await n.json();t.success?(N(t.message,"success"),X()):N(t.error,"error")}catch(e){N("Sunucu hatasÄ±!","error")}}async function Y(e,n){if(!l)return;const t=document.getElementById(`input-${e}`),a=parseFloat(t.value.replace(",","."));if(!a||isNaN(a)||a<=0)return N("GeÃ§ersiz miktar!","error");try{const n=await fetch("/api/borsa/sell",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,code:e,amount:a})}),t=await n.json();t.success?(N(t.message,"success"),X()):N(t.error,"error")}catch(e){N("Sunucu hatasÄ±!","error")}}let U="global";async function F(e){U=e,document.querySelectorAll("#tab-leaderboard .primary-btn").forEach(e=>e.classList.remove("active")),event.currentTarget.classList.add("active"),J()}async function J(){const e=document.getElementById("leaderboard-container");e.innerHTML='<div class="loading-spinner"></div>';try{const n=await fetch("/api/leaderboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:U,channelId:m})}),t=await n.json();e.innerHTML="",t.forEach((n,t)=>{const a=document.createElement("div");a.className="leader-item",a.innerHTML=`\n                <div style="display:flex; align-items:center; gap:15px;">\n                    <span class="rank">${t+1}.</span>\n                    <span style="font-weight:600;">${n.name.toUpperCase()}</span>\n                </div>\n                <span style="color:var(--primary); font-weight:800;">${n.is_infinite?"ğŸ’³â™¾ï¸":n.balance.toLocaleString()+" ğŸ’°"}</span>\n            `,e.appendChild(a)})}catch(n){console.error("Leaderboard Tablosu HatasÄ±:",n),e.innerHTML="<p>Leaderboard ÅŸu an yÃ¼klenemiyor.</p>"}}async function V(){if(!l)return;const n=document.getElementById("quests-container");n.innerHTML='<div class="loading-spinner"></div>';try{const t=(await e.ref("global_quests").once("value")).val()||{};let a=S;if(!a){try{a=(await e.ref("users/"+l).once("value")).val()}catch(e){}if(!a)try{const e=await fetch("/api/user/"+l),n=await e.json();n&&!n.error&&(a=n)}catch(e){}}a=a||{};const i=x(),r=a.quests?.[i]||{m:0,g:0,d:0,w:0,claimed:{}};if(n.innerHTML="",0===Object.keys(t).length)return void(n.innerHTML="<p style='text-align:center; color:var(--muted);'>Åu an aktif gÃ¶rev yok.</p>");Object.entries(t).forEach(([e,t])=>{const a=r[t.type]||0,i=r.claimed?.[e],o=a>=t.goal,s=Math.min(100,a/t.goal*100),c=document.createElement("div");c.className="quest-card",c.innerHTML=`\n                    <div style="display:flex; justify-content:space-between; align-items:center;">\n                        <h3>${t.name}</h3>\n                        <span style="color:var(--primary); font-weight:700;">+${(parseInt(t.reward)||0).toLocaleString()} ğŸ’°</span>\n                    </div>\n                    <p>GÃ¶rev TÃ¼rÃ¼: ${"m"===t.type?"Sohbet":"g"===t.type?"Kumar":"w"===t.type?"ğŸ‘ï¸ Ä°zleme":"âš”ï¸ DÃ¼ello"}</p>\n                    <div class="progress-bar"><div class="progress-fill" style="width: ${s}%"></div></div>\n                    <div style="display:flex; justify-content:space-between; align-items:center;">\n                        <small>${a}/${t.goal} ${"m"===t.type?"Mesaj":"Ä°ÅŸlem"}</small>\n                        <button class="primary-btn" style="width:auto; padding:8px 20px;" \n                            ${o&&!i?"":"disabled"} onclick="claimQuest('${e}')">\n                            ${i?"ALINDI":o?"Ã–DÃœLÃœ AL":"TAMAMLA"}\n                        </button>\n                    </div>\n                `,n.appendChild(c)})}catch(e){n.innerHTML="<p>GÃ¶revler yÃ¼klenemedi.</p>"}}async function Z(e){if(l)try{const n=await fetch("/api/claim-quest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,questId:e})}),t=await n.json();t.success?(N(`ğŸ‰ +${t.reward} ğŸ’° aldÄ±n!`,"success"),V(),X()):N(t.error,"error")}catch(e){N("BaÄŸlantÄ± hatasÄ±!","error")}}async function X(){if(!l)return;const n=document.getElementById("profile-card");let t=S;if(!t){try{const n=await e.ref("users/"+l).once("value");t=n.val()}catch(e){}if(!t)try{const e=await fetch("/api/user/"+l),n=await e.json();n&&!n.error&&(t=n)}catch(e){}}t=t||{balance:0};const a=d.colors.find(e=>e.id===t.name_color),o=d.backgrounds.find(e=>e.id===t.profile_bg),s=a?`color: ${a.color}; text-shadow: 0 0 15px ${a.color}88;`:"",c=o?o.style:"background: rgba(255,255,255,0.03);";n.style.cssText=`position:static; transform:none; width:100%; text-align:left; transition: all 0.5s ease; ${c}`,n.innerHTML=`\n            <div style="display:flex; flex-direction:column; gap:25px; padding: 30px;">\n                <div style="display:flex; align-items:center; gap:20px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:20px;">\n                    <div id="p-avatar" style="width:80px; height:80px; background:var(--primary); color:black; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:800; border:4px solid rgba(255,255,255,0.1);">\n                        ${l[0].toUpperCase()}\n                    </div>\n                    <div>\n                        <h2 style="${s} font-size:2rem; margin:0;">${l.toUpperCase()}</h2>\n                        <span style="background:rgba(255,255,255,0.1); padding:2px 10px; border-radius:20px; font-size:0.8rem; color:#ccc;">${t.job||"Ä°ÅŸsiz"}</span>\n                    </div>\n                </div>\n\n                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">\n                    <div class="stat-box" style="background:rgba(0,0,0,0.3);">\n                        <label>CÃ¼zdan</label>\n                        <div class="val">${t.is_infinite?"Omega'nÄ±n KartÄ± ğŸ’³â™¾ï¸":t.balance.toLocaleString()+" ğŸ’°"}</div>\n                    </div>\n                    <div class="stat-box" style="background:rgba(0,0,0,0.3);">\n                        <label>EÄŸitim</label>\n                        <div class="val">${i[t.edu||0]}</div>\n                    </div>\n                    <div class="stat-box" style="background:rgba(0,0,0,0.3);">\n                        <label>SÄ±ralama</label>\n                        <div class="val">#--</div>\n                    </div>\n                    <div class="stat-box" style="background:rgba(0,0,0,0.3);">\n                        <label>Durum</label>\n                        <div class="val">${(()=>{const e="omegacyr"===l.toLowerCase(),n=t.is_admin||e,a=t.badges||[],i=t.roles||[],r=e||a.some(e=>{const n="string"==typeof e?e:e.type||e.badge_type||"";return["subscriber","founder","vip","sub_gifter","og","moderator","broadcaster","abone"].includes(n.toLowerCase())})||i.some(e=>["subscriber","moderator","broadcaster","vip"].includes(e.toLowerCase()))||!0===t.is_subscriber||!0===t.isSubscriber;return n&&r?"ğŸ’ğŸ›¡ï¸ YÃ¶netici":n?"ğŸ›¡ï¸ YÃ¶netici":r?"ğŸ’ Abone":"ğŸ‘¤ TakipÃ§i"})()}</div>\n                    </div>\n                </div>\n\n                <div class="xp-section" style="background:rgba(255,255,255,0.03); padding:20px; border-radius:12px; border:1px solid var(--glass-border);">\n                    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:600;">\n                        <span>EÄŸitim XP</span>\n                        <span style="color:var(--primary);">${t.xp||0} / ${r[(t.edu||0)+1]||"MAX"}</span>\n                    </div>\n                    <div class="progress-bar" style="height:12px; background:#1a1a1a;">\n                        <div class="progress-fill" style="width: ${Math.min(100,(t.xp||0)/(r[(t.edu||0)+1]||t.xp||1)*100)}%;"></div>\n                    </div>\n                    <p style="font-size:0.75rem; color:#666; margin-top:8px;">\n                        Mesaj yazarak ve !Ã§alÄ±ÅŸ komutunu kullanarak XP kazanabilir, diplomanÄ± yÃ¼kseltebilirsin.\n                    </p>\n                </div>\n                \n                <div class="stats-section">\n                    <h3 style="margin-bottom:15px; font-size:1rem; opacity:0.8;">ğŸ“ˆ Ä°statistikler</h3>\n                    <div style="display:grid; grid-template-columns: repeat(2, 1fr); gap:15px; margin-bottom:15px;">\n                        <div class="stat-mini" style="border:1px solid #05ea6a33; background:rgba(5, 234, 106, 0.05);">\n                            <label style="color:var(--primary);">GÃ¼nlÃ¼k Ä°zleme</label>\n                            <div class="v" style="color:var(--primary);">${t.quests?.[x()]?.w||0} dk</div>\n                        </div>\n                        <div class="stat-mini" style="background:rgba(5, 234, 106, 0.1);">\n                            <label>Kanal Ä°zleme</label>\n                            <div class="v">${t.channel_watch_time?.[m]||0} dk</div>\n                        </div>\n                        <div class="stat-mini">\n                            <label>Toplam Ä°zleme</label>\n                            <div class="v">${t.lifetime_w||0} dk</div>\n                        </div>\n                        <div class="stat-mini">\n                            <label>Toplam Mesaj</label>\n                            <div class="v">${t.lifetime_m||0}</div>\n                        </div>\n                        <div class="stat-mini">\n                            <label>Toplam Kumar</label>\n                            <div class="v">${t.lifetime_g||0}</div>\n                        </div>\n                        <div class="stat-mini">\n                            <label>DÃ¼ello Galibiyet</label>\n                            <div class="v">${t.lifetime_d||0}</div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="portfolio-section" style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.1); padding-top:20px;">\n                    <h3 style="margin-bottom:15px; font-size:1rem; opacity:0.8;">ğŸ“‚ Borsa PortfÃ¶yÃ¼m</h3>\n                    <div id="user-portfolio" style="display:grid; grid-template-columns: repeat(2, 1fr); gap:10px;">\n                        ${t.stocks&&Object.keys(t.stocks).length>0?Object.entries(t.stocks).map(([e,n])=>{const a=t.stock_costs&&t.stock_costs[e]||0,i=n>0?a/n:0;return`\n                        <div class="stat-mini" style="border:1px solid #05ea6a33; background:rgba(5, 234, 106, 0.05); display:block;">\n                            <div style="display:flex; justify-content:space-between; align-items:center;">\n                                <label style="margin:0;">${e}</label>\n                                <span style="font-size:0.7rem; color:#aaa;">Ort: ${i>0?Math.floor(i).toLocaleString():"?"} ğŸ’°</span>\n                            </div>\n                            <div class="v" style="margin-top:5px;">${Number(n).toLocaleString("tr-TR",{maximumFractionDigits:4})} Adet</div>\n                        </div>\n                    `}).join(""):'<p style="grid-column: span 2; font-size: 0.8rem; color:#666;">HenÃ¼z hissedar deÄŸilsin.</p>'}\n                    </div>\n                </div>\n\n                <div class="emlak-portfolio-section" style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.1); padding-top:20px;">\n                    <h3 style="margin-bottom:15px; font-size:1rem; opacity:0.8;">ğŸ  Emlak PortfÃ¶yÃ¼m</h3>\n                    <div id="user-emlak" style="display:grid; grid-template-columns: 1fr; gap:10px;">\n                        ${t.properties&&t.properties.length>0?t.properties.map(e=>{const n={residence:"house",shop:"shop",land:"seedling"}[e.category]||"building",t=Math.floor(e.income/24);return`\n                                <div class="stat-mini" style="border:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.03); display:flex; justify-content:space-between; align-items:center;">\n                                    <div style="display:flex; gap:10px; align-items:center;">\n                                        <div style="width:35px; height:35px; background:rgba(255,255,255,0.05); border-radius:8px; display:flex; align-items:center; justify-content:center; color:var(--primary);">\n                                            <i class="fas fa-${n}"></i>\n                                        </div>\n                                        <div>\n                                            <label>${e.city||"Emlak"}</label>\n                                            <div class="v" style="font-size:0.85rem;">${e.name}</div>\n                                        </div>\n                                    </div>\n                                    <div style="text-align:right;">\n                                        <div style="color:var(--primary); font-weight:800; font-size:0.8rem;">+${t.toLocaleString()} ğŸ’°/sa</div>\n                                        <div style="font-size:0.65rem; color:#666;">GÃ¼nlÃ¼k: ${e.income.toLocaleString()}</div>\n                                    </div>\n                                </div>\n                            `}).join(""):'<p style="font-size: 0.8rem; color:#666;">HenÃ¼z mÃ¼lk sahibi deÄŸilsin.</p>'}\n                </div>\n\n                <div class="gang-section" style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.1); padding-top:20px;">\n                    <h3 style="margin-bottom:15px; font-size:1rem; opacity:0.8;">ğŸ´ Ã‡ete</h3>\n                    ${t.gang?'<div class="stat-mini" style="background:rgba(255, 0, 0, 0.1); border:1px solid rgba(255, 0, 0, 0.3); display:flex; justify-content:space-between; align-items:center; cursor:pointer;" onclick="switchTab(\'gangs\')">\n                            <div>\n                                <label>Ãœyesin</label>\n                                <div class="v" style="color:#e74c3c;">Ã‡eteye Git ></div>\n                            </div>\n                        </div>':'<div class="stat-mini" style="background:rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center;">\n                            <label>Bir Ã§eteye Ã¼ye deÄŸilsin.</label>\n                            <button class="secondary-btn" style="font-size:0.7rem; padding:4px 10px;" onclick="switchTab(\'gangs\')">Ã‡ete Kur/Bul</button>\n                        </div>'}\n                </div>\n            </div>\n        `}async function Q(){const n=document.getElementById("gang-lobby"),t=document.getElementById("gang-dashboard");if(!l)return n.classList.remove("hidden"),t.classList.add("hidden"),void(document.getElementById("public-gang-list").innerHTML='<div style="color:var(--primary); text-align:center; padding:20px;">Ã‡eteleri gÃ¶rmek ve katÄ±lmak iÃ§in giriÅŸ yapmalÄ±sÄ±n.</div>');await le();let a=S;if(!a)try{a=(await e.ref("users/"+l).once("value")).val(),S=a}catch(e){console.error("Gangs: User data fetch failed",e)}const i=a?.gang;if(console.log("Gangs Login Check:",{currentUser:l,gangId:i,hasUserData:!!a}),i){document.getElementById("gang-lobby").classList.add("hidden"),document.getElementById("gang-dashboard").classList.remove("hidden");try{const e=await fetch("/api/gang/list"),n=await e.json(),t=document.getElementById("public-gang-list-dashboard");if(t&&n.success){t.innerHTML="";const e=Object.values(n.gangs||{});0===e.length?t.innerHTML='<div style="color:#666; text-align:center; padding:20px;">BaÅŸka Ã§ete bulunamadÄ±.</div>':e.forEach(e=>{if(e.id===i)return;const n=document.createElement("div");n.className="gang-card",n.style="padding:15px 20px; display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; background:rgba(255,255,255,0.02);";const a=de.find(n=>n.id===e.baseCity)?.name||e.baseCity,r=e.level||1;n.innerHTML=`\n                            <div style="text-align:left;">\n                                <div style="font-weight:800; color:white; font-size:0.95rem; display:flex; align-items:center; gap:8px;">\n                                    <span style="background:rgba(255,255,255,0.1); color:rgba(255,255,255,0.7); padding:2px 6px; border-radius:4px; font-size:0.7rem;">${e.tag}</span>\n                                    ${e.name}\n                                </div>\n                                <div style="font-size:0.75rem; color:#666; margin-top:5px; display:flex; gap:10px;">\n                                    <span>ğŸ“ ${a}</span>\n                                    <span>â­ Lvl ${r}</span>\n                                    <span>ğŸ‘‘ ${e.leader}</span>\n                                </div>\n                            </div>\n                            <div style="font-size:0.85rem; color:var(--primary); font-weight:800; background:rgba(5,234,106,0.05); padding:5px 12px; border-radius:20px;">\n                                <i class="fas fa-users" style="font-size:0.7rem;"></i> ${e.memberCount}\n                            </div>\n                        `,t.appendChild(n)})}}catch(e){console.error("Dashboard Gang List Error",e)}try{const e=await fetch("/api/gang/info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({gangId:i})}),n=await e.json();if(n.success&&n.gang){const e=n.gang;document.getElementById("my-gang-name").innerText=e.name,document.getElementById("my-gang-tag").innerText=e.tag,document.getElementById("my-gang-leader").innerText=e.leader,document.getElementById("my-gang-balance").innerText=(e.balance||0).toLocaleString()+" ğŸ’°";const t=document.getElementById("gang-requests-section"),a=document.getElementById("gang-requests-list"),r=l.toLowerCase(),o=e.members[r]?.rank;if("leader"===o||"officer"===o){t.classList.remove("hidden"),a.innerHTML="";const n=Object.keys(e.requests||{});0===n.length?a.innerHTML='<div style="color:#666; font-size:0.8rem;">Bekleyen istek yok.</div>':n.forEach(e=>{const n=document.createElement("div");n.className="member-row",n.innerHTML=`\n                                <span><i class="fas fa-user-clock"></i> @${e}</span>\n                                <div style="display:flex; gap:5px;">\n                                    <button onclick="processGangRequest('${e}', 'approve', '${i}')" class="primary-btn" style="width:auto; padding:5px 10px; font-size:0.7rem; background:#05ea6a; color:black;">ONAYLA</button>\n                                    <button onclick="processGangRequest('${e}', 'reject', '${i}')" class="logout-btn" style="width:auto; padding:5px 10px; font-size:0.7rem;">REDDET</button>\n                                </div>\n                            `,a.appendChild(n)})}else t.classList.add("hidden");if(e.baseCity){const n=de.find(n=>n.id===e.baseCity)?.name||e.baseCity;let t=document.getElementById("gang-info-extra");if(!t){const e=document.querySelector("#gang-dashboard .gang-header > div:first-child");t=document.createElement("p"),t.id="gang-info-extra",t.style="color:#aaa; margin-top:5px; font-size:0.8rem;",e.appendChild(t)}t.innerText=`Ãœs: ${n}`}const s=document.getElementById("gang-members-list");if(!s)return;s.innerHTML="";let c=[];try{c=Object.entries(e.members||{})}catch(e){console.error("Members parse error",e),c=[]}const d=c.length,m={1:10,2:20,3:40,4:75,5:150}[e.level||1]||10,p=document.getElementById("my-gang-count");if(p&&(p.innerText=`${d}/${m}`),0===d)s.innerHTML='<div style="color:#666; font-size:0.8rem; text-align:center; padding:20px;">Kadro verisi yÃ¼klenemedi.</div>';else{c.sort((e,n)=>("leader"===n[1].rank?1:0)-("leader"===e[1].rank?1:0)),c.forEach(([e,n])=>{const t="leader"===n.rank,a="officer"===n.rank;let c="TetikÃ§i (Ãœye)",d="ğŸ”«";t?(c="Lider (Baba)",d="ğŸ‘‘"):a&&(c="SaÄŸ Kol (Officer)",d="âš”ï¸");const l=document.createElement("div");l.className="member-row";let m='<div style="display:flex; gap:8px;">';"leader"===o&&e.toLowerCase()!==r&&(m+=`<button onclick="promoteMember('${e}', '${a?"member":"officer"}', '${i}')" class="primary-btn" style="width:auto; padding:3px 8px; font-size:0.65rem; background:rgba(255,255,255,0.1); color:white; border:1px solid rgba(255,255,255,0.2);">${a?"RÃ¼tbe Ä°ndir":"SaÄŸ Kol Yap"}</button>`),("leader"===o&&e.toLowerCase()!==r||"officer"===o&&!t&&!a)&&(m+=`<button onclick="kickMember('${e}', '${i}')" class="logout-btn" style="width:auto; padding:3px 8px; font-size:0.65rem; border:1px solid rgba(255,50,50,0.3);">AT</button>`),m+="</div>",l.innerHTML=`\n                            <div style="display:flex; align-items:center; gap:10px;">\n                                <span style="font-size:1.2rem;">${d}</span>\n                                <div style="text-align:left;">\n                                    <div style="font-weight:700; color:white;">@${e}</div>\n                                    <div style="font-size:0.7rem; color:#888;">${c}</div>\n                                </div>\n                            </div>\n                            ${m}\n                        `,s.appendChild(l)});const n=e.level||1,t=e.balance||0,a={1:1e6,2:5e6,3:25e6,4:1e8}[n],d=n+1,l=document.getElementById("gang-info-extra");if(l){const a=de.find(n=>n.id===e.baseCity)?.name||e.baseCity;l.innerHTML=`\n                            Ãœs: <b>${a}</b> | Seviye: <b>${n}</b> | Kasa: <b style="color:var(--primary);">${t.toLocaleString()} ğŸ’°</b>\n                        `}const m=document.getElementById("gang-top-actions");if(m){m.innerHTML="";const e=document.createElement("button");if(e.className="primary-btn",e.style="flex:1;",e.innerHTML="ğŸ’° KASAYA BAÄIÅ YAP",e.onclick=()=>Oe(i),m.appendChild(e),"leader"===o&&a){const e=document.createElement("button");e.className="primary-btn",e.style="flex:1; background: linear-gradient(45deg, #ffd700, #ff8c00); color:black; font-weight:800; border:none;",e.innerHTML=`<i class="fas fa-arrow-up"></i> YÃœKSELT (${(a/1e6).toLocaleString()}M)`,e.onclick=()=>Me(i,a,d),m.appendChild(e)}else if("leader"===o&&!a){const e=document.createElement("button");e.className="secondary-btn",e.style="flex:1;",e.innerHTML="MAX SEVÄ°YE",e.disabled=!0,m.appendChild(e)}const n=document.createElement("button");n.className="logout-btn",n.style="flex:0.3; height: 50px;",n.innerText="AyrÄ±l",n.onclick=()=>ee(),m.appendChild(n)}s.parentNode.querySelectorAll(".gang-extras").forEach(e=>e.remove()),Be(i,o)}}else console.error("Gang load failed:",n.error),N("Ã‡ete bilgileri alÄ±namadÄ±!","error")}catch(e){console.error("Gang Info Fetch Error:",e),N("BaÄŸlantÄ± hatasÄ±!","error")}}else{n.classList.remove("hidden"),t.classList.add("hidden");const e=document.getElementById("gang-city-input");e&&e.options.length<=1&&de.sort((e,n)=>e.name.localeCompare(n.name)).forEach(n=>{const t=document.createElement("option");t.value=n.id,t.innerText=n.name,e.appendChild(t)});try{const e=await fetch("/api/gang/list"),n=await e.json(),t=document.getElementById("public-gang-list");if(t&&n.success){t.innerHTML="";const e=Object.values(n.gangs||{});0===e.length?t.innerHTML='<div style="color:#666; text-align:center; padding:20px;">HenÃ¼z kurulmuÅŸ Ã§ete yok.</div>':e.forEach(e=>{const n=document.createElement("div");n.className="gang-card",n.style="margin-bottom:15px; padding:20px; display:flex; justify-content:space-between; align-items:center; position:relative; overflow:hidden;";const a=Object.keys(e.members||{}).length,i=de.find(n=>n.id===e.baseCity)?.name||e.baseCity,r=e.level||1,o={1:10,2:20,3:40,4:75,5:150}[r]||10;n.innerHTML=`\n                            <div style="position:absolute; top:-10px; right:-10px; font-size:4rem; opacity:0.03; font-weight:900; pointer-events:none; font-style:italic;">${e.tag}</div>\n                            <div style="text-align:left; position:relative; z-index:1;">\n                                <div style="font-weight:900; color:white; font-size: 1.1rem; display:flex; align-items:center; gap:10px;">\n                                    <span style="background:var(--primary); color:black; padding:3px 10px; border-radius:6px; font-size:0.8rem; font-weight:900; box-shadow:0 0 10px var(--primary-dim);">${e.tag}</span>\n                                    ${e.name}\n                                </div>\n                                <div style="font-size:0.8rem; color:#aaa; margin-top:10px; display:flex; gap:15px; align-items:center;">\n                                    <span title="Ãœs Åehri"><i class="fas fa-map-marker-alt" style="color:var(--primary);"></i> ${i}</span>\n                                    <span title="Lider"><i class="fas fa-crown" style="color:#ffd700;"></i> ${e.leader}</span>\n                                    <span title="Seviye"><i class="fas fa-star" style="color:#5dade2;"></i> Seviye ${r}</span>\n                                    <span title="Ãœye SayÄ±sÄ±"><i class="fas fa-users" style="color:#aaa;"></i> ${a}/${o} Ãœye</span>\n                                </div>\n                            </div>\n                            <button onclick="joinGang('${e.id}')" class="primary-btn" style="width:auto; padding:10px 25px; font-size:0.85rem; border-radius:30px; position:relative; z-index:1; border:none; box-shadow: 0 4px 15px rgba(5,234,106,0.3);">\n                                <i class="fas fa-user-plus"></i> KATIL\n                            </button>\n                        `,t.appendChild(n)})}}catch(e){console.error("Public Gang List Error",e)}}}async function W(){const e=document.getElementById("gang-name-input").value.trim(),n=document.getElementById("gang-tag-input").value.trim(),t=document.getElementById("gang-city-input").value;if(!e||!n||!t)return N("Ad, etiket ve ÅŸehir zorunlu!","error");n.toUpperCase(),N("Ã‡ete kuruluyor...","info");try{const a=await fetch("/api/gang/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,name:e,tag:n,baseCity:t})}),i=await a.json();if(i.success){N("ğŸ´ Ã‡ete baÅŸarÄ±yla kuruldu!","success");const e=await fetch("/api/user/"+l);S=await e.json(),Q(),S.is_infinite?document.getElementById("user-balance").innerText="Omega'nÄ±n KartÄ± ğŸ’³â™¾ï¸":document.getElementById("user-balance").innerText=S.balance.toLocaleString()+" ğŸ’°"}else N(i.error||"Hata oluÅŸtu!","error")}catch(e){N("Sunucu hatasÄ±!","error")}}async function ee(){const e="leader"===S?.gangRank?"Ã‡ete Liderisin! AyrÄ±lÄ±rsan Ã§ete tamamen feshedilecek (disband). Emin misin?":"Ã‡eteden ayrÄ±lmak istediÄŸine emin misin?";if(await Ke("AyrÄ±lma OnayÄ±",e))try{const e=await fetch("/api/gang/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l})}),n=await e.json();if(n.success){N(n.message,"success");const e=await fetch("/api/user/"+l);S=await e.json(),Q()}else N(n.error||"Hata!","error")}catch(e){N("BaÄŸlantÄ± hatasÄ±!","error")}}async function ne(e){if(!l)return N("LÃ¼tfen giriÅŸ yapÄ±n!","error");N("Ã‡eteye katÄ±lÄ±nÄ±yor...","info");try{const n=await fetch("/api/gang/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,gangId:e})}),t=await n.json();if(t.success){N("ğŸ´ Ã‡eteye baÅŸarÄ±yla katÄ±ldÄ±n!","success");const e=await fetch("/api/user/"+l);S=await e.json(),Q()}else N(t.error||"Hata oluÅŸtu!","error")}catch(e){N("BaÄŸlantÄ± hatasÄ±!","error")}}async function te(e,n,t){console.log(`ğŸ”„ Gang Request: ${n} for ${e} in ${t} by ${l}`);try{const a=await fetch("/api/gang/process-request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requester:l,targetUser:e,action:n,gangId:t})}),i=await a.json();console.log("ğŸ“© Gang Request Response:",i),i.success?(N(i.message,"success"),setTimeout(()=>Q(),500)):N(i.error||"Hata!","error")}catch(e){console.error("âŒ Gang Request Error:",e),N("Ä°ÅŸlem hatasÄ±: "+e.message,"error")}}async function ae(e,n,t){try{const a=await fetch("/api/gang/promote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requester:l,targetUser:e,newRank:n,gangId:t})}),i=await a.json();i.success?(N(i.message,"success"),Q()):N(i.error||"Hata!","error")}catch(e){N("BaÄŸlantÄ± hatasÄ±!","error")}}async function ie(e,n){if(await Ke("ğŸ‘¢ Ãœye At",`${e} kullanÄ±cÄ±sÄ±nÄ± Ã§eteden atmak istediÄŸine emin misin?`))try{const t=await fetch("/api/gang/kick",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requester:l,target:e,gangId:n})}),a=await t.json();a.success?(N(a.message,"success"),Q()):N(a.error||"Hata!","error")}catch(e){N("BaÄŸlantÄ± hatasÄ±!","error")}}function re(){document.getElementById("gang-donate-modal").classList.remove("hidden"),document.getElementById("gang-donate-input").value=""}function oe(){document.getElementById("gang-donate-modal").classList.add("hidden")}async function se(){const e=parseInt(document.getElementById("gang-donate-input").value);if(!e||e<=0)return N("GeÃ§erli bir miktar girin!","error");oe(),N("BaÄŸÄ±ÅŸ iÅŸleniyor...","info");try{const n=await fetch("/api/gang/donate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,amount:e})}),t=await n.json();t.success?(N(`ğŸ’ Ã‡ete kasasÄ±na ${e.toLocaleString()} ğŸ’° baÄŸÄ±ÅŸladÄ±n!`,"success"),Q()):N(t.error||"Hata!","error")}catch(e){N("BaÄŸlantÄ± hatasÄ±!","error")}}async function ce(){const e=prompt("Ne kadar baÄŸÄ±ÅŸlamak istersin?");if(e)try{const n=await fetch("/api/gang/donate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,amount:e})}),t=await n.json();t.success?(N("âœ… BaÄŸÄ±ÅŸ yapÄ±ldÄ±!","success"),S?.is_infinite||(document.getElementById("user-balance").innerText=t.newBalance.toLocaleString()+" ğŸ’°"),Q()):N(t.error,"error")}catch(e){N("BaÄŸÄ±ÅŸ hatasÄ±","error")}}const de=[{id:"ADANA",name:"Adana",x:50,y:81},{id:"ADIYAMAN",name:"AdÄ±yaman",x:66,y:72},{id:"AFYONKARAHISAR",name:"Afyon",x:25,y:53},{id:"AGRI",name:"AÄŸrÄ±",x:91,y:38},{id:"AMASYA",name:"Amasya",x:53,y:23},{id:"ANKARA",name:"Ankara",x:38,y:34},{id:"ANTALYA",name:"Antalya",x:26,y:83},{id:"ARTVIN",name:"Artvin",x:84,y:15},{id:"AYDIN",name:"AydÄ±n",x:11,y:68},{id:"BALIKESIR",name:"BalÄ±kesir",x:12,y:39},{id:"BILECIK",name:"Bilecik",x:23,y:31},{id:"BINGOL",name:"BingÃ¶l",x:77,y:51},{id:"BITLIS",name:"Bitlis",x:86,y:59},{id:"BOLU",name:"Bolu",x:31,y:22},{id:"BURDUR",name:"Burdur",x:24,y:70},{id:"BURSA",name:"Bursa",x:18,y:30},{id:"CANAKKALE",name:"Ã‡anakkale",x:4,y:31},{id:"CANKIRI",name:"Ã‡ankÄ±rÄ±",x:42,y:24},{id:"CORUM",name:"Ã‡orum",x:49,y:25},{id:"DENIZLI",name:"Denizli",x:18,y:69},{id:"DIYARBAKIR",name:"DiyarbakÄ±r",x:76,y:66},{id:"EDIRNE",name:"Edirne",x:5,y:7},{id:"ELAZIG",name:"ElazÄ±ÄŸ",x:71,y:54},{id:"ERZINCAN",name:"Erzincan",x:72,y:37},{id:"ERZURUM",name:"Erzurum",x:81,y:35},{id:"ESKISEHIR",name:"EskiÅŸehir",x:25,y:37},{id:"GAZIANTEP",name:"Gaziantep",x:61,y:80},{id:"GIRESUN",name:"Giresun",x:66,y:19},{id:"GUMUSHANE",name:"GÃ¼mÃ¼ÅŸhane",x:72,y:26},{id:"HAKKARI",name:"Hakkari",x:94,y:72},{id:"HATAY",name:"Hatay",x:55,y:94},{id:"ISPARTA",name:"Isparta",x:26,y:69},{id:"MERSIN",name:"Mersin",x:47,y:84},{id:"ISTANBUL",name:"Ä°stanbul",x:17,y:17},{id:"IZMIR",name:"Ä°zmir",x:8,y:58},{id:"KARS",name:"Kars",x:91,y:24},{id:"KASTAMONU",name:"Kastamonu",x:42,y:12},{id:"KAYSERI",name:"Kayseri",x:52,y:48},{id:"KIRKLARELI",name:"KÄ±rklareli",x:8,y:6},{id:"KIRSEHIR",name:"KÄ±rÅŸehir",x:44,y:47},{id:"KOCAELI",name:"Kocaeli",x:22,y:21},{id:"KONYA",name:"Konya",x:36,y:67},{id:"KUTAHYA",name:"KÃ¼tahya",x:23,y:43},{id:"MALATYA",name:"Malatya",x:66,y:60},{id:"MANISA",name:"Manisa",x:9,y:55},{id:"KAHRAMANMARAS",name:"KahramanmaraÅŸ",x:59,y:72},{id:"MARDIN",name:"Mardin",x:79,y:76},{id:"MUGLA",name:"MuÄŸla",x:14,y:78},{id:"MUS",name:"MuÅŸ",x:83,y:54},{id:"NEVSEHIR",name:"NevÅŸehir",x:47,y:55},{id:"NIGDE",name:"NiÄŸde",x:47,y:66},{id:"ORDU",name:"Ordu",x:64,y:18},{id:"RIZE",name:"Rize",x:78,y:17},{id:"SAKARYA",name:"Sakarya",x:25,y:21},{id:"SAMSUN",name:"Samsun",x:56,y:13},{id:"SIIRT",name:"Siirt",x:85,y:66},{id:"SINOP",name:"Sinop",x:50,y:1},{id:"SIVAS",name:"Sivas",x:59,y:37},{id:"TEKIRDAG",name:"TekirdaÄŸ",x:10,y:18},{id:"TOKAT",name:"Tokat",x:57,y:28},{id:"TRABZON",name:"Trabzon",x:73,y:17},{id:"TUNCELI",name:"Tunceli",x:72,y:48},{id:"SANLIURFA",name:"ÅanlÄ±urfa",x:69,y:78},{id:"USAK",name:"UÅŸak",x:20,y:54},{id:"VAN",name:"Van",x:92,y:57},{id:"YOZGAT",name:"Yozgat",x:48,y:36},{id:"ZONGULDAK",name:"Zonguldak",x:32,y:10},{id:"AKSARAY",name:"Aksaray",x:44,y:59},{id:"BAYBURT",name:"Bayburt",x:76,y:29},{id:"KARAMAN",name:"Karaman",x:39,y:78},{id:"KIRIKKALE",name:"KÄ±rÄ±kkale",x:41,y:36},{id:"BATMAN",name:"Batman",x:81,y:67},{id:"SIRNAK",name:"ÅÄ±rnak",x:88,y:73},{id:"BARTIN",name:"BartÄ±n",x:35,y:7},{id:"ARDAHAN",name:"Ardahan",x:89,y:16},{id:"IGDIR",name:"IÄŸdÄ±r",x:96,y:35},{id:"YALOVA",name:"Yalova",x:19,y:23},{id:"KARABUK",name:"KarabÃ¼k",x:36,y:14},{id:"KILIS",name:"Kilis",x:60,y:86},{id:"OSMANIYE",name:"Osmaniye",x:55,y:80},{id:"DUZCE",name:"DÃ¼zce",x:29,y:20}];async function le(){return!0}let me=!1;async function pe(){if(!me){if(me=!0,await le(),"omegacyr"===l){const e=document.getElementById("tab-emlak"),n=document.createElement("button");n.innerHTML="ğŸš¨ EMLAK SÄ°STEMÄ°NÄ° SIFIRLA (ADMÄ°N)",n.className="primary-btn",n.style="background: #ff4d4d; color: white; margin-bottom: 20px; width: auto; padding: 10px 25px;",n.onclick=async()=>{if(!await Ke("ğŸš¨ Emlak SÄ±fÄ±rlama","TÃ¼m ÅŸehirlerdeki mÃ¼lkleri ve tÃ¼m kullanÄ±cÄ±larÄ±n tapularÄ±nÄ± silmek istediÄŸine emin misin? (FiyatlarÄ± gÃ¼ncellemek iÃ§in gereklidir)"))return;const e=await fetch("/api/emlak/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requester:"omegacyr"})}),n=await e.json();n.success?(N(n.message,"success"),setTimeout(()=>location.reload(),1500)):N(n.error||"Hata oluÅŸtu","error")},e.insertBefore(n,e.firstChild)}ge()}}async function ue(){if(!l)return;const n=document.getElementById("career-grid");n.innerHTML='<div class="loader"></div>';let t=S;if(!t){try{const n=await e.ref("users/"+l).once("value");t=n.val()}catch(e){console.log("Career DB Error",e)}if(!t)try{const e=await fetch("/api/user/"+l),n=await e.json();n&&!n.error&&(t=n,S||_(t))}catch(e){console.log("Career API Error",e)}}t=t||{};const a=t.edu||0,r=t.job||"Ä°ÅŸsiz";n.innerHTML="",Object.entries(c).forEach(([e,o])=>{if("Ä°ÅŸsiz"===e)return;const s=a>=o.req_edu,c=t.items&&t.items[o.req_item],d=r===e,l=document.createElement("div");l.className="market-card "+(d?"active-job":""),l.style.opacity=s?"1":"0.5",l.innerHTML=`\n            <div class="item-icon">${o.icon}</div>\n            <div class="item-info">\n                <h3>${e}</h3>\n                <p>MaaÅŸ: <span class="item-cost">${o.reward.toLocaleString()} ğŸ’°</span> / GÃ¼nlÃ¼k</p>\n                <div style="font-size:0.8rem; margin-top:5px; color:#aaa;">\n                    ğŸ“ ${i[o.req_edu]}<br>\n                    ğŸ“¦ ${o.req_item}\n                </div>\n            </div>\n            <button class="buy-btn" onclick="applyForJob('${e}', ${o.price||0})" \n                ${d?"disabled":""}>\n                ${d?"Zaten Bu Ä°ÅŸteler":c?"Hemen BaÅŸla":`${(o.price||0).toLocaleString()} ğŸ’° Al`}\n            </button>\n        `,n.appendChild(l)})}async function ye(e,n){if(!l)return;const t=c[e];let a=await w();if(a=a||{balance:0,items:{}},(a.edu||0)<t.req_edu)return N(`EÄŸitim seviyen yetersiz! (${i[t.req_edu]} gereklidir)`,"error");if(!a.items||!a.items[t.req_item]){if(!a.is_infinite&&(a.balance||0)<n)return N("Bakiye yetersiz! âŒ","error");a.is_infinite?t.req_item:(t.req_item,n.toLocaleString())}try{const n=await fetch("/api/jobs/apply",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("aloskegang_token")}`},body:JSON.stringify({username:l,jobName:e})}),t=await n.json();t.success?(N(t.message,"success"),ue(),X()):N(t.error||"Ä°ÅŸlem baÅŸarÄ±sÄ±z.","error")}catch(e){console.error(e),N("Sunucu hatasÄ±!","error")}}function ge(){const e=document.getElementById("map-overlay");e&&(e.innerHTML="",de.forEach(n=>{const t=document.createElement("div");t.className="city-dot",t.style.left=`${n.x}%`,t.style.top=`${n.y}%`,t.style.transform="translate(-50%, -50%)",t.addEventListener("mouseenter",()=>{const e=document.getElementById("city-info-toast");e.querySelector("span").innerText=n.name.toUpperCase(),e.style.display="flex"}),t.addEventListener("mouseleave",()=>{document.getElementById("city-info-toast").style.display="none"}),t.addEventListener("click",()=>{document.querySelectorAll(".city-dot").forEach(e=>e.classList.remove("active")),t.classList.add("active"),xe(n.id,n.name)}),e.appendChild(t)}))}let fe=[],be="",ve="";function he(e,n){if(n&&(document.querySelectorAll(".filter-btn").forEach(e=>{e.classList.remove("active"),e.style.color="#aaa"}),n.classList.add("active"),n.style.color="#fff"),!fe)return;let t=[];t="all"===e?fe:fe.filter(n=>n.category===e),ke(t,be,ve)}function ke(e,n,t){const a=document.getElementById("city-properties-list");a&&(a.innerHTML="",a.style.display="grid",a.style.gridTemplateColumns="repeat(auto-fill, minmax(280px, 1fr))",a.style.gap="20px",a.style.padding="10px",e&&0!==e.length?e.forEach((e,i)=>{const r=document.createElement("div");r.className="property-card";let o="#444",s="linear-gradient(135deg, rgba(255,255,255,0.03), rgba(0,0,0,0.5))",c="#aaa",d="MÃœLK";"residence"===e.category?(o="#00E676",c="#69F0AE",d="KONUT",s="linear-gradient(135deg, rgba(0, 230, 118, 0.05), rgba(0,0,0,0.4))"):"shop"===e.category?(o="#2979FF",c="#448AFF",d="DÃœKKAN",s="linear-gradient(135deg, rgba(41, 121, 255, 0.05), rgba(0,0,0,0.4))"):"land"===e.category&&(o="#FFC400",c="#FFD740",d="ARAZÄ°",s="linear-gradient(135deg, rgba(255, 196, 0, 0.05), rgba(0,0,0,0.4))");const m=!!e.owner,p=e.owner&&e.owner.toLowerCase()===l&&(S?.properties||[]).some(n=>n.id===e.id);r.style.background=p?"linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(0,0,0,0.4))":s,r.style.border=p?"1px solid #FFD700":`1px solid ${o}33`,r.style.boxShadow=p?"0 0 15px rgba(255, 215, 0, 0.1)":"0 4px 6px rgba(0,0,0,0.3)",r.style.borderRadius="16px",r.style.display="flex",r.style.flexDirection="column",r.style.padding="0",r.style.overflow="hidden",r.style.position="relative",r.style.animation=`fadeInUp 0.5s forwards ${.05*i}s`,r.style.opacity="0";let u="";"residence"===e.category&&e.income>0?u=`\n                <div style="margin-top:15px; background:rgba(0,0,0,0.3); padding:10px; border-radius:10px; display:flex; justify-content:space-between; align-items:center;">\n                    <span style="color:#aaa; font-size:0.8rem;">GÃœNLÃœK GELÄ°R</span>\n                    <div style="display:flex; align-items:center; gap:5px;">\n                        <i class="fas fa-arrow-trend-up" style="color:#00ff88; font-size:0.9rem;"></i>\n                        <span style="color:#00ff88; font-weight:700;">+${e.income.toLocaleString()} ğŸ’°</span>\n                    </div>\n                </div>\n            `:"shop"===e.category&&(u='\n                <div style="margin-top:15px; background:rgba(255,255,255,0.03); padding:10px; border-radius:10px; display:flex; align-items:center; justify-content:center; gap:8px;">\n                    <i class="fas fa-briefcase" style="color:#aaa; font-size:0.9rem;"></i>\n                    <span style="color:#888; font-size:0.8rem;">Ä°ÅŸletme Kurulabilir</span>\n                </div>\n            ');let y="";y=p?'\n                <div style="background:#FFD700; color:#000; font-weight:900; padding:12px; text-align:center; font-size:0.9rem; letter-spacing:1px; margin-top:auto;">\n                    <i class="fas fa-check-circle"></i> SÄ°ZÄ°N MÃœLKÃœNÃœZ\n                </div>':m?`\n                <div style="background:#ff3333; color:#fff; font-weight:800; padding:12px; text-align:center; font-size:0.9rem; letter-spacing:1px; margin-top:auto;">\n                    <i class="fas fa-lock"></i> SAHÄ°BÄ°: @${e.owner}\n                </div>`:`\n                <button onclick="executePropertyBuy('${n}', '${e.id}', ${e.price}, '${t}')" \n                    class="buy-btn-anim"\n                    style="\n                        width:100%; padding:14px; background:var(--primary); color:#000; border:none; \n                        font-weight:900; cursor:pointer; font-size:1rem; margin-top:auto;\n                        transition: background 0.2s;\n                    "\n                    onmouseover="this.style.background='#00e676'"\n                    onmouseout="this.style.background='var(--primary)'"\n                >\n                    SATIN AL\n                </button>\n            `,r.innerHTML=`\n            <div style="padding:20px; display:flex; flex-direction:column; gap:10px; height:100%;">\n                \n                <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px;">\n                    <div style="display:flex; align-items:center; gap:15px; flex:1;">\n                        <div style="width:50px; height:50px; background:${o}22; border-radius:12px; display:flex; align-items:center; justify-content:center; box-shadow:inset 0 0 10px ${o}11; flex-shrink:0;">\n                            <i class="fa-solid fa-${e.icon||"building"}" style="font-size:1.6rem; color:${c};"></i>\n                        </div>\n                        <div style="flex:1;">\n                            <div style="font-size:1.1rem; font-weight:800; color:#fff; line-height:1.2; margin-bottom:4px; word-break: break-word;">${e.name.replace(t,"").trim()}</div>\n                            <div style="font-size:0.9rem; font-weight:700; color:#fff;">${e.price.toLocaleString()} ğŸ’°</div>\n                        </div>\n                    </div>\n                    <div style="font-size:0.7rem; font-weight:800; color:${o}; background:${o}22; padding:4px 10px; border-radius:6px; letter-spacing:0.5px; white-space:nowrap;">\n                        ${d}\n                    </div>\n                </div>\n\n                ${u}\n\n                <div style="flex:1;"></div> \x3c!-- Spacer --\x3e\n            </div>\n            ${y}\n        `,a.appendChild(r)}):a.innerHTML='\n            <div style="grid-column: 1 / -1; text-align:center; padding:40px; color:#666; display:flex; flex-direction:column; align-items:center;">\n                <i class="fas fa-search" style="font-size:2rem; margin-bottom:15px; opacity:0.5;"></i>\n                <p>Bu kategoride mÃ¼lk bulunamadÄ±.</p>\n            </div>\n        ')}async function xe(e,n){const t=document.getElementById("city-properties-list");if(!t)return;be=e,ve=n;const a=document.getElementById("city-title");a&&(a.innerText=n);const i=document.getElementById("property-filters");i&&(i.style.display="flex"),document.querySelectorAll(".filter-btn").forEach(e=>{e.classList.remove("active"),e.style.color="#aaa"});const r=document.querySelector(".filter-btn:first-child");r&&(r.classList.add("active"),r.style.color="#fff"),t.innerHTML='<div class="loader" style="margin: 20px auto;"></div>';try{const a=await fetch(`/api/real-estate/properties/${e}?_t=${Date.now()}`),i=await a.json();if(fe=i||[],!fe||0===fe.length)return void(t.innerHTML='\n                <div style="text-align:center; padding:30px 10px; background: rgba(255, 0, 0, 0.05); border: 1px dashed rgba(255, 0, 0, 0.3); border-radius: 15px; grid-column: 1 / -1;">\n                    <i class="fas fa-lock" style="font-size: 2.5rem; color: #ff4d4d; margin-bottom: 15px;"></i>\n                    <h4 style="color: white; margin-bottom: 10px;">Veri BulunamadÄ± veya EriÅŸim Engellendi</h4>\n                    <p style="font-size: 0.8rem; color: #aaa; line-height: 1.5;">Sunucudan mÃ¼lk verisi alÄ±namadÄ±.</p>\n                </div>\n            ');ke(fe,e,n)}catch(e){t.innerHTML=`\n            <div style="text-align:center; padding:20px; color:var(--danger); grid-column: 1 / -1;">\n                <i class="fas fa-exclamation-triangle" style="font-size:2rem; margin-bottom:10px;"></i>\n                <p>Veriler yÃ¼klenemedi!</p>\n                <p style="font-size:0.7rem; color:#888; margin-top:10px;">\n                    Hata: ${e.message}\n                </p>\n            </div>\n        `}}async function we(e,n,t,a){if(!l)return N("GiriÅŸ yapmalÄ±sÄ±n!","error");const i=await w();i?.is_infinite||t.toLocaleString();try{const t=await fetch("/api/real-estate/buy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("aloskegang_token")}`},body:JSON.stringify({username:l,cityId:e,propertyId:n})}),i=await t.json();i.success?(N(i.message,"success"),X(),xe(e,a)):N(i.error,"error")}catch(e){N("Ä°ÅŸlem sÄ±rasÄ±nda bir hata oluÅŸtu!","error")}}async function $e(){const n=document.getElementById("stats-container");if(n)if(m){n.innerHTML='<div class="loader"></div>';try{const t=(await e.ref("users").once("value")).val()||{},a=Object.entries(t).map(([e,n])=>({name:e,...n,chan_m:n.channel_m?.[m]||0,chan_w:n.channel_watch_time?.[m]||0})).filter(e=>{const n=e.name.toLowerCase().replace("@","");return(e.chan_m>0||e.chan_w>0)&&!["aloskegangbot","botrix"].includes(n)});if(0===a.length)return void(n.innerHTML='<p style="text-align:center; padding:40px; color:#666;">Bu kanal iÃ§in henÃ¼z istatistik verisi toplanmamÄ±ÅŸ.</p>');const i=[...a].sort((e,n)=>(n.balance||0)-(e.balance||0)).slice(0,25),r=[...a].sort((e,n)=>n.chan_m-e.chan_m).slice(0,25),o=[...a].sort((e,n)=>n.chan_w-e.chan_w).slice(0,25);n.innerHTML=`\n            <div class="glass-panel" style="padding:20px;">\n                <h3 style="color:var(--primary); margin-bottom:15px; display:flex; align-items:center; gap:10px;">ğŸ† Kanal Zenginleri <small style="font-size:0.6rem; color:#666;">(Global Bakiye)</small></h3>\n                <div style="display:flex; flex-direction:column; gap:10px;">\n                    ${i.map((e,n)=>`\n                        <div style="display:flex; align-items:center; justify-content:space-between; background:rgba(255,255,255,0.03); padding:10px; border-radius:10px;">\n                            <span style="font-weight:700;">${n+1}. ${e.name.toUpperCase()}</span>\n                            <span style="color:var(--primary); font-weight:800;">${e.is_infinite?"ğŸ’³â™¾ï¸":(e.balance||0).toLocaleString()+" ğŸ’°"}</span>\n                        </div>\n                    `).join("")}\n                </div>\n            </div>\n\n            <div class="glass-panel" style="padding:20px;">\n                <h3 style="color:var(--secondary); margin-bottom:15px; display:flex; align-items:center; gap:10px;">ğŸ’¬ En Aktif Chat <small style="font-size:0.6rem; color:#666;">(Bu Kanal)</small></h3>\n                <div style="display:flex; flex-direction:column; gap:10px;">\n                    ${r.map((e,n)=>{const t=r[0].chan_m||1,a=e.chan_m/t*100;return`\n                            <div style="display:flex; flex-direction:column; gap:5px; background:rgba(255,255,255,0.03); padding:10px; border-radius:10px;">\n                                <div style="display:flex; justify-content:space-between; font-size:0.85rem;">\n                                    <span style="font-weight:700;">${n+1}. ${e.name.toUpperCase()}</span>\n                                    <span>${e.chan_m.toLocaleString()} Mesaj</span>\n                                </div>\n                                <div class="progress-bar" style="height:6px; background:rgba(255,255,255,0.05);"><div class="progress-fill" style="width:${a}%; background:var(--secondary);"></div></div>\n                            </div>\n                        `}).join("")}\n                </div>\n            </div>\n\n            <div class="glass-panel" style="padding:20px;">\n                <h3 style="color:#f1c40f; margin-bottom:15px; display:flex; align-items:center; gap:10px;">ğŸ‘ï¸ SadÄ±k Ä°zleyiciler <small style="font-size:0.6rem; color:#666;">(Bu Kanal)</small></h3>\n                <div style="display:flex; flex-direction:column; gap:10px;">\n                    ${o.map((e,n)=>{const t=o[0].chan_w||1,a=e.chan_w/t*100;return`\n                            <div style="display:flex; flex-direction:column; gap:5px; background:rgba(255,255,255,0.03); padding:10px; border-radius:10px;">\n                                <div style="display:flex; justify-content:space-between; font-size:0.85rem;">\n                                    <span style="font-weight:700;">${n+1}. ${e.name.toUpperCase()}</span>\n                                    <span>${e.chan_w.toLocaleString()} dk</span>\n                                </div>\n                                <div class="progress-bar" style="height:6px; background:rgba(255,255,255,0.05);"><div class="progress-fill" style="width:${a}%; background:#f1c40f;"></div></div>\n                            </div>\n                        `}).join("")}\n                </div>\n            </div>\n        `}catch(e){n.innerHTML="<p>Ä°statistikler ÅŸu an yÃ¼klenemiyor.</p>"}}else n.innerHTML='<p style="text-align:center; padding:40px; color:#666;">Kanal istatistiklerini gÃ¶rmek iÃ§in bir kanalda !doÄŸrulama yapmalÄ±sÄ±n.</p>'}async function ze(){if(!l)return;document.getElementById("my-rpg-stats").innerHTML='<div class="loader"></div>',document.getElementById("arena-weapons").innerHTML='<div class="loader"></div>',document.getElementById("arena-armors").innerHTML='<div class="loader"></div>';const n=((await e.ref("users/"+l).once("value")).val()||{balance:0}).rpg||{level:1,hp:100,xp:0,str:5,def:0,weapon:"yumruk",armor:"tisort"},t=n.inventory||[],a=o[n.weapon]||o.yumruk,i=s[n.armor]||s.tisort,r=(n.hp||100)+(i.hp||0),c=(n.str||5)+(a.dmg||0),d=(n.def||0)+(i.def||0);document.getElementById("my-rpg-stats").innerHTML=`\n        <div style="display:flex; justify-content:space-between; align-items:center;">\n            <div>\n                <strong style="color:var(--primary); font-size:1.2rem;">Level ${n.level||1}</strong>\n                <p style="margin-top:5px; font-size:0.9rem;">\n                   â¤ï¸ HP: ${r} | âš”ï¸ STR: ${c} | ğŸ›¡ï¸ DEF: ${d}\n                </p>\n                <p style="font-size:0.8rem; color:#888;">XP: ${n.xp||0}</p>\n            </div>\n            <div style="text-align:right;">\n                <div style="margin-bottom:5px;">${a.icon} ${a.name}</div>\n                <div>${i.icon} ${i.name}</div>\n            </div>\n        </div>\n    `;const m=document.getElementById("arena-weapons");m.innerHTML="",Object.entries(o).forEach(([e,a])=>{if("yumruk"===e)return;const i=t.includes(e)||e===n.weapon,r=e===n.weapon,o=document.createElement("div");o.className="market-card",o.innerHTML=`\n            <div class="item-icon">${a.icon}</div>\n            <div class="item-info">\n                <h3>${a.name}</h3>\n                <p style="color:#aaa;">+${a.dmg} Hasar</p>\n                <div class="item-cost">${a.price.toLocaleString()} ğŸ’°</div>\n            </div>\n            <button class="buy-btn" onclick="buyRpgItem('${e}', 'weapon')" ${r?"disabled":""}>\n                ${r?"KUÅANILDI":i?"KUÅAN":"SATIN AL"}\n            </button>\n        `,m.appendChild(o)});const p=document.getElementById("arena-armors");p.innerHTML="",Object.entries(s).forEach(([e,a])=>{if("tisort"===e)return;const i=t.includes(e)||e===n.armor,r=e===n.armor,o=document.createElement("div");o.className="market-card",o.innerHTML=`\n            <div class="item-icon">${a.icon}</div>\n            <div class="item-info">\n                <h3>${a.name}</h3>\n                <p style="color:#aaa;">+${a.def} Defans | +${a.hp} HP</p>\n                <div class="item-cost">${a.price.toLocaleString()} ğŸ’°</div>\n            </div>\n            <button class="buy-btn" onclick="buyRpgItem('${e}', 'armor')" ${r?"disabled":""}>\n                ${r?"KUÅANILDI":i?"KUÅAN":"SATIN AL"}\n            </button>\n        `,p.appendChild(o)})}async function Se(e,n){if(!l)return;const t="weapon"===n?o[e]:s[e];if(!t)return;await w();t.name;try{const t=await fetch("/api/rpg/buy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("aloskegang_token")}`},body:JSON.stringify({username:l,type:n,code:e})}),a=await t.json();a.success?(N(a.message,"success"),ze(),X()):N(a.error||"Ä°ÅŸlem baÅŸarÄ±sÄ±z.","error")}catch(e){console.error(e),N("Hata oluÅŸtu.","error")}}async function _e(){document.querySelectorAll(".tab-content").forEach(e=>e.classList.add("hidden"));const e=document.getElementById("tab-career");e.classList.remove("hidden"),document.querySelectorAll(".tab-btn").forEach(e=>e.classList.remove("active")),document.querySelector("button[onclick=\"switchTab('career')\"]").classList.add("active");const n=e.querySelector("h2"),t=e.querySelector("p");n.innerHTML="âœ¨ Profil Ã–zelleÅŸtirme MaÄŸazasÄ±",t.innerHTML="Ä°smini renklendir ve profiline ÅŸÄ±k arka planlar ekleyerek fark yarat! (AldÄ±ÄŸÄ±n her yenisi eskisinin yerine geÃ§er)";const a=document.getElementById("career-grid");a.innerHTML="";const i=document.createElement("div");i.innerHTML='<button class="primary-btn" style="width: auto; padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);">ğŸ”™ Mesleklere Geri DÃ¶n</button>',i.style="grid-column: 1 / -1; margin-bottom: 20px;",i.onclick=()=>{n.innerHTML="ğŸ’¼ Kariyer & Meslekler",t.innerHTML="Ä°ÅŸe baÅŸlamak iÃ§in diploman (eÄŸitim seviyen) yetmeli ve gerekli meslek eÅŸyasÄ±nÄ± satÄ±n almalÄ±sÄ±n.",ue()},a.appendChild(i),d.colors.forEach(e=>{const n=document.createElement("div");n.className="market-card",n.innerHTML=`\n            <div class="item-icon" style="color:${e.color}; text-shadow: 0 0 10px ${e.color};">ğŸ¨</div>\n            <div class="item-info">\n                <h3 style="color:${e.color}">${e.name}</h3>\n                <p>Ä°sim Rengi</p>\n                <span class="item-cost">${e.price.toLocaleString()} ğŸ’°</span>\n            </div>\n            <button class="buy-btn" onclick="buyCustomization('color', '${e.id}', ${e.price})">SatÄ±n Al</button>\n        `,a.appendChild(n)}),d.backgrounds.forEach(e=>{const n=document.createElement("div");n.className="market-card",n.innerHTML=`\n            <div class="item-icon" style="${e.style}; border-radius:10px; width:40px; height:40px; margin: 0 auto 10px;"></div>\n            <div class="item-info">\n                <h3>${e.name}</h3>\n                <p>Profil ArkaplanÄ±</p>\n                <span class="item-cost">${e.price.toLocaleString()} ğŸ’°</span>\n            </div>\n            <button class="buy-btn" onclick="buyCustomization('bg', '${e.id}', ${e.price})">SatÄ±n Al</button>\n        `,a.appendChild(n)})}async function Ae(e,n,t){if(!l)return;const a=await w();a?.is_infinite||t.toLocaleString();try{const t=await fetch("/api/customization/buy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("aloskegang_token")}`},body:JSON.stringify({username:l,type:e,id:n})}),a=await t.json();a.success?(N(a.message,"success"),X()):N(a.error||"Ä°ÅŸlem baÅŸarÄ±sÄ±z.","error")}catch(e){console.error(e),N("Sunucu hatasÄ±!","error")}}function qe(e,n){return new Promise(t=>{const a=document.getElementById("alert-modal");if(!a)return console.warn("Alert modal not found, fallback to native"),alert(n),void t();const i=document.getElementById("alert-modal-title"),r=document.getElementById("alert-modal-message");i&&(i.innerHTML=e),r&&(r.innerHTML=n),a.classList.remove("hidden"),a.style.display="flex";const o=document.getElementById("alert-modal-btn");o?o.onclick=()=>{a.classList.add("hidden"),a.style.display="none",t()}:setTimeout(()=>{a.classList.add("hidden"),a.style.display="none",t()},2e3)})}function Te(e,n,t){return new Promise(a=>{const i=document.getElementById("input-modal");if(!i){const e=prompt(n);return void a(e)}const r=document.getElementById("input-modal-title"),o=document.getElementById("input-modal-desc"),s=document.getElementById("input-modal-value");r&&(r.innerHTML=e),o&&(o.innerHTML=n),s&&(s.value="",s.placeholder=t||"..."),i.classList.remove("hidden"),i.style.display="flex",s&&s.focus();const c=()=>{i.classList.add("hidden"),i.style.display="none"},d=document.getElementById("input-modal-confirm"),l=document.getElementById("input-modal-cancel");if(d&&l){const e=d.cloneNode(!0),n=l.cloneNode(!0);d.parentNode.replaceChild(e,d),l.parentNode.replaceChild(n,l),e.onclick=()=>{const e=s?s.value.trim():"";e?(c(),a(e)):s&&(s.style.border="1px solid red",setTimeout(()=>s.style.border="1px solid var(--glass-border)",1e3))},n.onclick=()=>{c(),a(null)},s&&(s.onkeydown=t=>{"Enter"===t.key&&e.click(),"Escape"===t.key&&n.click()})}else c(),a(null)})}function Ke(e,n,t){return"function"==typeof n&&(t=n,n=e,e="Onay"),new Promise(a=>{const i=document.getElementById("confirm-modal");if(!i){const i=confirm("string"==typeof n?n:e);return t&&t(i),void a(i)}const r=document.getElementById("confirm-modal-title"),o=document.getElementById("confirm-modal-message");r&&(r.innerHTML=e),o&&(o.innerHTML=n),i.classList.remove("hidden"),i.style.display="flex";const s=document.getElementById("confirm-modal-yes"),c=document.getElementById("confirm-modal-cancel"),d=s.cloneNode(!0),l=c.cloneNode(!0);s.parentNode.replaceChild(d,s),c.parentNode.replaceChild(l,c),d.onclick=()=>{i.style.display="none",i.classList.add("hidden"),t&&t(!0),a(!0)},l.onclick=()=>{i.style.display="none",i.classList.add("hidden"),t&&t(!1),a(!1)}})}async function Oe(e){re()}async function Me(e,n,t){if(await Ke(`Ã‡ete Seviyesi ${t}`,`Kasadaki paradan ${(n/1e6).toLocaleString()}M ğŸ’° harcanarak Ã§ete seviyesi yÃ¼kseltilecek. Kapasite artacak. OnaylÄ±yor musunuz?`))try{const n=await fetch("/api/gang/upgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,gangId:e})}),t=await n.json();t.success?(N(t.message,"success"),Q()):N(t.error,"error")}catch(e){N("Hata oluÅŸtu","error")}}let Ie=null;function Be(n,t){Ie&&(Ie.off(),Ie=null);const a=document.getElementById("gang-chat-messages"),i=document.getElementById("gang-chat-input-section"),r=document.getElementById("gang-chat-readonly-notice"),o=document.getElementById("gang-chat-input");a&&("leader"===t||"officer"===t?(i.classList.remove("hidden"),r.classList.add("hidden"),o.onkeydown=e=>{"Enter"===e.key&&je()}):(i.classList.add("hidden"),r.classList.remove("hidden")),Ie=e.ref(`gangs/${n}/chat`).orderByChild("timestamp").limitToLast(50),Ie.on("value",e=>{a.innerHTML="";const n=[];e.forEach(e=>{n.push({id:e.key,...e.val()})}),0===n.length?a.innerHTML='<div style="color:#666; font-size:0.85rem; text-align:center; padding:20px;">Mesaj yok. Ä°lk mesajÄ± sen gÃ¶nder!</div>':(n.forEach(e=>{const n=document.createElement("div");n.style="background:rgba(255,255,255,0.03); border-left:3px solid var(--primary); padding:10px; border-radius:8px;";const t=new Date(e.timestamp).toLocaleString("tr-TR",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit"});let i="ğŸ‘¤";"leader"===e.rank?i="ğŸ‘‘":"officer"===e.rank&&(i="âš”ï¸"),n.innerHTML=`\n                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">\n                        <span style="font-weight:700; color:var(--primary); font-size:0.9rem;">\n                            ${i} @${e.username}\n                        </span>\n                        <span style="font-size:0.7rem; color:#666;">${t}</span>\n                    </div>\n                    <div style="color:#ddd; font-size:0.9rem; word-wrap:break-word;">${Ne(e.message)}</div>\n                `,a.appendChild(n)}),a.scrollTop=a.scrollHeight)}))}async function je(){const e=document.getElementById("gang-chat-input"),n=e.value.trim();if(!n)return;if(!l||!S?.gang)return void N("Ã‡ete bilgisi bulunamadÄ±!","error");const t=S.gang;try{const a=await fetch("/api/gang/sendMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,gangId:t,message:n})}),i=await a.json();i.success?(e.value="",N("Mesaj gÃ¶nderildi!","success")):N(i.error||"Mesaj gÃ¶nderilemedi!","error")}catch(e){N("BaÄŸlantÄ± hatasÄ±!","error")}}function Ne(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}function Ee(){const e=document.getElementById("shopCalcCode"),n=document.getElementById("shopCalcAmount");if(!e||!n)return;const t=e.value.toUpperCase().trim(),a=parseFloat(n.value),i=document.getElementById("shopCalcBuy"),r=document.getElementById("shopCalcSell");if(!t||!a||a<=0||!window.shopStocks||!window.shopStocks[t])return i.innerText="0 ğŸ’°",void(r.innerText="0 ğŸ’°");const o=window.shopStocks[t].price,s=o*a,c=o*a,d=c-.1*c;i.innerText=Math.floor(s).toLocaleString()+" ğŸ’°",r.innerText=Math.floor(d).toLocaleString()+" ğŸ’°"}let De={},Re={},Pe={},Le={},Ge={},Ce={},He=[],Ye=[];async function Ue(){try{const e=await fetch("/api/business/types"),n=await e.json();n.success&&(De=n.types||{},Re=n.products||{},Pe=n.licenses||{},Le=n.levels||{},Ge=n.advertising||{});const t=await fetch("/api/business/market"),a=await t.json();a.success&&(Ce=a.prices||{},He=a.events||[],Fe())}catch(e){console.error("Business data load error:",e)}}function Fe(){const e=document.getElementById("market-events-list");e&&(0!==He.length?e.innerHTML=He.map(e=>`\n        <div class="glass-panel" style="padding:10px; margin-bottom:10px; border-left:4px solid var(--primary);">\n            <div style="font-weight:700; color:var(--primary); margin-bottom:4px;">${e.name}</div>\n            <div style="font-size:0.8rem; opacity:0.8;">${e.desc||"Piyasa koÅŸullarÄ± deÄŸiÅŸiyor..."}</div>\n        </div>\n    `).join(""):e.innerHTML='<span style="opacity:0.7">Åu an aktif kÃ¼resel bir olay yok.</span>')}function Je(e){document.querySelectorAll(".business-sub-content").forEach(e=>e.classList.add("hidden")),document.querySelectorAll(".sub-tab-btn").forEach(e=>e.classList.remove("active"));const n=document.getElementById("business-sub-"+e);n&&n.classList.remove("hidden"),event.target.classList.add("active"),"my-businesses"===e?Ve():"new-business"===e?Qe():"licenses"===e?We():"market-prices"===e?en():"warehouse"===e?zn():"rnd"===e&&_n()}async function Ve(){if(!l)return;const e=document.getElementById("my-businesses-list");e.innerHTML='<div style="text-align:center; padding:40px;"><div class="loader"></div></div>';try{const n=await fetch(`/api/business/my-businesses?username=${encodeURIComponent(l)}`),a=await n.json();if(!a.success||!a.businesses||0===a.businesses.length)return void(e.innerHTML='\n                <div style="grid-column: 1/-1; text-align:center; padding:60px; opacity:0.5;">\n                    <i class="fas fa-store-slash" style="font-size:4rem; margin-bottom:20px;"></i>\n                    <p>HenÃ¼z iÅŸletmen yok. Yeni bir iÅŸletme kurmak iÃ§in "â• Yeni Ä°ÅŸletme" sekmesine git.</p>\n                </div>');Ye=a.licenses||[];const i={retail:{name:"ğŸ›’ Perakende Ä°ÅŸletmeler",businesses:[],icon:"ğŸª"},production:{name:"ğŸ­ Ãœretim Tesisleri",businesses:[],icon:"ğŸ­"},farming:{name:"ğŸŒ¾ TarÄ±m Ä°ÅŸletmeleri",businesses:[],icon:"ğŸŒ¾"},livestock:{name:"ğŸ„ HayvancÄ±lÄ±k Ä°ÅŸletmeleri",businesses:[],icon:"ğŸ„"},special:{name:"â­ Ã–zel Ä°ÅŸletmeler",businesses:[],icon:"âš¡"}};for(const e of a.businesses){const n=e.typeData?.category||"retail";i[n]&&i[n].businesses.push(e)}e.innerHTML="";for(const[n,a]of Object.entries(i)){if(0===a.businesses.length)continue;const n=document.createElement("div");n.style.cssText="grid-column: 1/-1; margin:30px 0 15px 0; padding:15px 20px; background:linear-gradient(90deg, rgba(0,255,136,0.1), transparent); border-left:4px solid var(--primary); border-radius:8px;",n.innerHTML=`\n                <h3 style="margin:0; font-size:1.3rem; font-weight:800;">${a.name}</h3>\n                <div style="font-size:0.85rem; color:#888; margin-top:5px;">${a.businesses.length} iÅŸletme</div>\n            `,e.appendChild(n);for(const n of a.businesses){const a=document.createElement("div");a.className="glass-panel",a.style.cssText="padding:20px; border-radius:16px;";const i=n.health>70?"#00ff88":n.health>30?"#ffaa00":"#ff4444",r=n.typeData||{},o=(n.levelData,Object.entries(n.inventory||{}).filter(([e,n])=>n>0).map(([e,n])=>`${Re[e]?.icon||""} ${n}`).slice(0,5).join(" "));a.innerHTML=`\n                <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:15px;">\n                    <div>\n                        <div style="font-size:2rem; margin-bottom:5px;">${r.icon||"ğŸª"}</div>\n                        <h3 style="margin:0; font-size:1.2rem;">${t(n.name)}</h3>\n                        <div style="font-size:0.8rem; color:#888;">${r.name} â€¢ ${n.city}</div>\n                    </div>\n                    <div style="text-align:right;">\n                        <div style="font-size:0.75rem; color:#888;">SEVÄ°YE</div>\n                        <div style="font-size:1.5rem; font-weight:900; color:var(--primary);">${n.level}</div>\n                    </div>\n                </div>\n                \n                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">\n                    <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:8px;">\n                        <div style="font-size:0.7rem; color:#888;">ğŸ”§ SAÄLIK</div>\n                        <div style="height:6px; background:#333; border-radius:3px; margin-top:5px; overflow:hidden;">\n                            <div style="height:100%; width:${n.health}%; background:${i}; border-radius:3px;"></div>\n                        </div>\n                        <div style="font-size:0.75rem; color:${i}; margin-top:3px;">${Math.floor(n.health)}%</div>\n                    </div>\n                    <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:8px;">\n                        <div style="font-size:0.7rem; color:#888;">ğŸ“¦ DEPO</div>\n                        <div style="font-size:0.85rem; margin-top:5px;">${o||"BoÅŸ"}</div>\n                    </div>\n                </div>\n                \n                <div style="display:flex; gap:8px; flex-wrap:wrap;">\n                    ${r.produces?`<button onclick="businessProduce('${n.id}')" class="btn-sm" style="background:linear-gradient(135deg, #00ff88, #00cc66);">âš™ï¸ Ãœret</button>`:""}\n                    <button onclick="showBusinessSellModal('${n.id}')" class="btn-sm" style="background:linear-gradient(135deg, #4488ff, #2266cc);">ğŸ’° Sat</button>\n                    <button onclick="businessMaintain('${n.id}')" class="btn-sm" style="background:linear-gradient(135deg, #ff8800, #cc6600);">ğŸ”§ BakÄ±m</button>\n                    <button onclick="businessUpgrade('${n.id}')" class="btn-sm" style="background:linear-gradient(135deg, #aa44ff, #8822cc);">â¬†ï¸ YÃ¼kselt</button>\n                </div>\n                \n                <div style="margin-top:15px; padding-top:15px; border-top:1px solid rgba(255,255,255,0.1); font-size:0.75rem; color:#666;">\n                    Toplam SatÄ±ÅŸ: ${(n.total_sales||0).toLocaleString()} adet â€¢ Gelir: ${(n.total_revenue||0).toLocaleString()} ğŸ’°\n                </div>\n            `,e.appendChild(a)}}}catch(n){console.error("My businesses load error:",n),e.innerHTML='<div style="text-align:center; padding:40px; color:#ff4444;">Ä°ÅŸletmeler yÃ¼klenemedi.</div>'}}let Ze="all";function Xe(e,n){Ze=e,document.querySelectorAll(".filter-btn").forEach(e=>{e.classList.remove("active"),e.style.background="rgba(255,255,255,0.05)",e.style.color="#aaa"}),n&&(n.classList.add("active"),n.style.background="rgba(255,255,255,0.1)",n.style.color="#fff"),Qe()}function Qe(){const e=document.getElementById("business-types-grid");if(!e)return;const n={retail:{name:"ğŸ›’ Perakende",items:[]},production:{name:"ğŸ­ Ãœretim",items:[]},farming:{name:"ğŸŒ¾ TarÄ±m",items:[]},livestock:{name:"ğŸ„ HayvancÄ±lÄ±k",items:[]},special:{name:"âš¡ Ã–zel Ä°ÅŸletmeler",items:[]}};for(const[e,t]of Object.entries(De))"all"!==Ze&&t.category!==Ze||n[t.category]&&n[t.category].items.push({code:e,...t});let t="";for(const[e,a]of Object.entries(n))if(0!==a.items.length){t+=`<div style="grid-column: 1/-1; margin-top:20px; margin-bottom:10px;">\n            <h3 style="margin:0; font-size:1.2rem;">${a.name}</h3>\n        </div>`;for(const e of a.items){const n=e.requiredLicense&&!Ye.includes(e.requiredLicense),a=e.requiredLicense?Pe[e.requiredLicense]:null;t+=`\n                <div class="glass-panel" style="padding:20px; border-radius:16px; ${n?"opacity:0.6;":""}">\n                    <div style="font-size:2.5rem; text-align:center; margin-bottom:10px;">${e.icon}</div>\n                    <h4 style="margin:0 0 5px 0; text-align:center;">${e.name}</h4>\n                    <div style="text-align:center; font-size:0.85rem; color:var(--primary); font-weight:bold; margin-bottom:10px;">\n                        ${e.setupCost.toLocaleString()} ğŸ’°\n                    </div>\n                    \n                    <div style="font-size:0.75rem; color:#888; margin-bottom:10px;">\n                        ${e.produces?`Ãœretim: ${e.produces.map(e=>Re[e]?.icon||e).join(" ")}`:`SatÄ±ÅŸ: ${e.products?.map(e=>Re[e]?.icon||e).join(" ")||""}`}\n                    </div>\n                    \n                    ${n?`<div style="font-size:0.75rem; color:#ff8800; margin-bottom:10px;">ğŸ”’ ${a?.name||"Lisans"} gerekli</div>`:""}\n                    \n                    <button onclick="showCreateBusinessModal('${e.code}')" class="buy-btn" style="width:100%; ${n?"opacity:0.5; pointer-events:none;":""}">\n                        ${n?"ğŸ”’ Lisans Gerekli":"ğŸ—ï¸ Kur"}\n                    </button>\n                </div>\n            `}}e.innerHTML=t}function We(){const e=document.getElementById("licenses-grid");if(!e)return;let n="";for(const[e,t]of Object.entries(Pe)){const a=Ye.includes(e);n+=`\n            <div class="glass-panel" style="padding:20px; border-radius:16px; ${a?"border: 2px solid var(--primary);":""}">\n                <div style="font-size:2rem; margin-bottom:10px;">${t.icon||"ğŸ“œ"}</div>\n                <h4 style="margin:0 0 5px 0;">${t.name}</h4>\n                <div style="font-size:0.85rem; color:var(--primary); font-weight:bold; margin-bottom:10px;">\n                    ${t.price.toLocaleString()} ğŸ’°\n                </div>\n                ${t.requiresEdu?`<div style="font-size:0.75rem; color:#888; margin-bottom:10px;">ğŸ“š EÄŸitim ${t.requiresEdu}+ gerekli</div>`:""}\n                \n                ${a?'<div style="text-align:center; color:var(--primary); font-weight:bold;">âœ… Sahipsin</div>':`<button onclick="buyLicense('${e}')" class="buy-btn" style="width:100%;">SatÄ±n Al</button>`}\n            </div>\n        `}e.innerHTML=n||'<div style="text-align:center; padding:40px; opacity:0.5;">Lisans bulunamadÄ±.</div>'}function en(){const e=document.getElementById("product-prices-table");if(!e)return;const n={raw:"ğŸŒ¿ Hammadde",processed:"âš™ï¸ Ä°ÅŸlenmiÅŸ",fresh:"ğŸ¥¬ Taze",animal:"ğŸ¥© Hayvansal",premium:"ğŸ’ Premium",ready:"ğŸ½ï¸ HazÄ±r"},t={1:{name:"Ã‡ok DÃ¼ÅŸÃ¼k",color:"#ff4444"},2:{name:"DÃ¼ÅŸÃ¼k",color:"#ff9944"},3:{name:"Orta",color:"#ffdd44"},4:{name:"YÃ¼ksek",color:"#99ff44"},5:{name:"Ã‡ok YÃ¼ksek",color:"#00ff88"}};let a="";for(const[e,i]of Object.entries(n)){const n=Object.entries(Re).filter(([n,t])=>t.category===e);if(0!==n.length){a+=`<div style="grid-column: 1/-1; margin-top:15px; font-weight:bold; color:var(--primary);">${i}</div>`;for(const[e,i]of n){let n=3;const r=(Ce[e]||i.basePrice)/i.basePrice;n=r<=.6?1:r<=.85?2:r<=1.15?3:r<=1.4?4:5;const o=t[n];a+=`\n                <div style="background:rgba(0,0,0,0.3); padding:12px 15px; border-radius:10px; display:flex; justify-content:space-between; align-items:center; border-left:3px solid ${o.color};">\n                    <span>${i.icon} ${i.name}</span>\n                    <span style="font-weight:800; color:${o.color}; font-size:0.95rem;">${o.name}</span>\n                </div>\n            `}}}e.innerHTML=a||'<div style="text-align:center; padding:40px; opacity:0.5;">Piyasa verileri yÃ¼kleniyor...</div>'}function nn(e){const n=De[e];n&&Ke(`\n        <h3>${n.icon} ${n.name} Kur</h3>\n        <div style="margin:15px 0;">\n            <input type="text" id="new-biz-name" placeholder="Ä°ÅŸletme AdÄ±" class="borsa-input" style="width:100%; margin-bottom:10px;">\n            <select id="new-biz-city" class="borsa-input" style="width:100%;">\n                ${["Ä°stanbul","Ankara","Ä°zmir","Amasya","Bursa","Antalya"].map(e=>`<option value="${e}">${e}</option>`).join("")}\n            </select>\n        </div>\n        <p style="color:#888; font-size:0.85rem;">KuruluÅŸ maliyeti: <b style="color:var(--primary);">${n.setupCost.toLocaleString()} ğŸ’°</b></p>\n    `,async()=>{const n=document.getElementById("new-biz-name").value.trim(),t=document.getElementById("new-biz-city").value;if(!n)return N("Ä°ÅŸletme adÄ± gerekli!","error");try{const a=await fetch("/api/business/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,businessType:e,city:t,name:n})}),i=await a.json();N(i.message||i.error,i.success?"success":"error"),i.success&&(Ve(),Je("my-businesses"))}catch(e){N("Hata: "+e.message,"error")}})}async function tn(e){Ke("Bu lisansÄ± satÄ±n almak istediÄŸine emin misin?",async()=>{try{const n=await fetch("/api/business/buy-license",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,licenseCode:e})}),t=await n.json();N(t.message||t.error,t.success?"success":"error"),t.success&&(Ye.push(e),We(),Qe())}catch(e){N("Hata: "+e.message,"error")}})}async function an(e){try{const n=await fetch(`/api/business/my-businesses?username=${encodeURIComponent(l)}`),t=await n.json();if(!t.success)return void N("Ä°ÅŸletme bilgisi alÄ±namadÄ±!","error");const a=t.businesses.find(n=>n.id===e);if(!a)return void N("Ä°ÅŸletme bulunamadÄ±!","error");const i=(De[a.type]||{}).produces||[];if(0===i.length)return void N("Bu iÅŸletme Ã¼retim yapmaz!","error");1===i.length?rn(e,i[0]):Ke(`\n                <h3>âš™ï¸ ÃœrÃ¼n SeÃ§imi</h3>\n                <p style="margin:10px 0; color:#888;">Hangi Ã¼rÃ¼nÃ¼ Ã¼retmek istiyorsun?</p>\n                <select id="produce-select" class="borsa-input" style="width:100%;">\n                    ${i.map(e=>{const n=Re[e];return`<option value="${e}">${n?.icon||""} ${n?.name||e}</option>`}).join("")}\n                </select>\n            `,()=>{const n=document.getElementById("produce-select").value;rn(e,n)})}catch(e){N("Hata: "+e.message,"error")}}async function rn(e,n){try{const t=await fetch("/api/business/produce",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,businessId:e,selectedProduct:n})}),a=await t.json();N(a.message||a.error,a.success?"success":"error"),a.success&&Ve()}catch(e){N("Hata: "+e.message,"error")}}async function on(e){Ke("Ä°ÅŸletme bakÄ±mÄ± yapmak istiyor musun?",async()=>{try{const n=await fetch("/api/business/maintain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,businessId:e})}),t=await n.json();N(t.message||t.error,t.success?"success":"error"),t.success&&Ve()}catch(e){N("Hata: "+e.message,"error")}})}async function sn(e){Ke("Ä°ÅŸletmeyi yÃ¼kseltmek istiyor musun?",async()=>{try{const n=await fetch("/api/business/upgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,businessId:e})}),t=await n.json();N(t.message||t.error,t.success?"success":"error"),t.success&&Ve()}catch(e){N("Hata: "+e.message,"error")}})}function cn(e){N("SatÄ±ÅŸ fonksiyonu yakÄ±nda!","info")}function dn(){Ue().then(()=>{Ve()})}function ln(e){return e>=75?"#00ff88":e>=50?"#ffaa00":e>=25?"#ff8800":"#ff4444"}function mn(e){return e>=90?"MÃ¼kemmel":e>=75?"Ä°yi":e>=50?"Orta":e>=25?"DÃ¼ÅŸÃ¼k":"Ã‡ok DÃ¼ÅŸÃ¼k"}let pn=null,un=null;function yn(e){pn&&clearInterval(pn),un=e,gn(),pn=setInterval(gn,5e3)}async function gn(){if(un&&!document.getElementById("gang-dashboard").classList.contains("hidden"))try{const e=await fetch(`/api/gang/chat/list?gangId=${un}&limit=50`),n=await e.json(),t=document.getElementById("gang-chat-messages");if(!t)return;if(n.success){const e=Object.values(n.messages||{});if(0===e.length)return void(t.innerHTML='<div style="text-align:center; color:#666; font-size:0.8rem; margin-top:20px;">HenÃ¼z mesaj yok. Ä°lk mesajÄ± sen yaz!</div>');t.innerHTML=e.map(e=>{const n=e.sender.toLowerCase()===l.toLowerCase(),t=new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return`\n                    <div style="display:flex; flex-direction:column; align-items:${n?"flex-end":"flex-start"};">\n                        <div style="display:flex; align-items:center; gap:5px; margin-bottom:2px;">\n                            <span style="font-size:0.7rem; color:${n?"#00ff88":"#aaa"}; font-weight:700;">\n                                ${"leader"===e.rank?"ğŸ‘‘":"officer"===e.rank?"âš”ï¸":""} ${e.sender}\n                            </span>\n                            <span style="font-size:0.6rem; color:#666;">${t}</span>\n                        </div>\n                        <div style="\n                            background:${n?"rgba(0, 255, 136, 0.1)":"rgba(255, 255, 255, 0.05)"}; \n                            border:1px solid ${n?"rgba(0, 255, 136, 0.2)":"rgba(255, 255, 255, 0.1)"};\n                            padding:8px 12px; \n                            border-radius:12px; \n                            border-${n?"top-right":"top-left"}-radius:0;\n                            color:#ddd; \n                            font-size:0.9rem;\n                            max-width:85%;\n                            word-wrap:break-word;\n                        ">\n                            ${e.text}\n                        </div>\n                    </div>\n                `}).join(""),t.scrollTop=t.scrollHeight}}catch(e){console.error("Chat refresh error",e)}}async function fn(){const e=document.getElementById("gang-chat-input"),n=e.value.trim();if(n&&un){e.value="";try{const e=await fetch("/api/gang/chat/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,gangId:un,message:n})}),t=await e.json();t.success?gn():N("Mesaj gÃ¶nderilemedi: "+t.error,"error")}catch(e){N("Hata oluÅŸtu!","error")}}}function bn(e){document.querySelectorAll(".market-sub-content").forEach(e=>e.classList.add("hidden")),document.getElementById("market-sub-"+e).classList.remove("hidden"),document.querySelectorAll("#tab-marketplace .sub-tab-btn").forEach(e=>e.classList.remove("active")),event&&event.currentTarget&&event.currentTarget.classList.add("active"),"browse"===e&&vn(),"my-listings"===e&&hn(),"create"===e&&kn(),Ue()}async function vn(){try{const e=await fetch("/api/marketplace/listings"),n=await e.json(),t=document.getElementById("marketplace-listings");if(!n.success||0===n.listings.length)return void(t.innerHTML='<div style="grid-column:1/-1; text-align:center; padding:60px; opacity:0.5;"><div style="font-size:4rem; margin-bottom:20px;">ğŸª</div><p>HenÃ¼z ilan yok. Ä°lk satÄ±cÄ± sen ol!</p></div>');let a="";for(const e of n.listings){const n=Re[e.productCode]||{name:e.productCode,icon:"ğŸ“¦"},t=e.isSystem,i=e.quality||0;a+=`\n                <div class="glass-panel" style="padding:20px; border-radius:16px; border:1px solid ${t?"var(--primary)":"rgba(255,255,255,0.05)"}; position:relative;">\n                    ${t?'<div style="position:absolute; top:10px; right:10px; background:var(--primary); color:black; font-size:0.6rem; padding:2px 6px; border-radius:4px; font-weight:800;">SÄ°STEM</div>':""}\n                    <div style="font-size:2.5rem; text-align:center; margin-bottom:10px;">${n.icon}</div>\n                    <h4 style="margin:0 0 5px 0; text-align:center;">${n.name}</h4>\n                    <div style="text-align:center; color:#888; font-size:0.85rem; margin-bottom:10px;">\n                        SatÄ±cÄ±: <b style="color:${t?"var(--primary)":"#fff"};">${e.seller}</b>\n                    </div>\n                    <div style="text-align:center; margin-bottom:10px;">\n                        <div style="font-size:0.7rem; color:#888; text-transform:uppercase;">Kalite</div>\n                        <div style="font-size:1.1rem; font-weight:800; color:var(--secondary);">%${i}</div>\n                    </div>\n                    <div style="text-align:center; margin-bottom:10px;">\n                        <span style="font-size:1.5rem; font-weight:800; color:var(--primary);">${e.quantity}</span>\n                        <span style="color:#888; font-size:0.9rem;"> adet</span>\n                    </div>\n                    <div style="text-align:center; font-size:1.2rem; font-weight:700; margin-bottom:15px; color:#fff;">\n                        ğŸ’° ${e.totalPrice.toLocaleString()}\n                    </div>\n                    <button onclick="buyMarketListing('${e.id}')" class="buy-btn" style="width:100%;">${t?"ğŸ›’ Hemen Al":"SatÄ±n Al"}</button>\n                </div>\n            `}t.innerHTML=a}catch(e){N("Pazar yeri yÃ¼klenemedi!","error"),console.error("Marketplace error:",e)}}async function hn(){try{const e=await fetch("/api/marketplace/listings"),n=await e.json(),t=document.getElementById("my-listings-grid");if(!n.success)return void(t.innerHTML='<div style="grid-column:1/-1; text-align:center; padding:60px; opacity:0.5;"><p>Bir hata oluÅŸtu.</p></div>');const a=n.listings.filter(e=>e.seller===l);if(0===a.length)return void(t.innerHTML='<div style="grid-column:1/-1; text-align:center; padding:60px; opacity:0.5;"><div style="font-size:4rem; margin-bottom:20px;">ğŸ“¦</div><p>HenÃ¼z ilanÄ±n yok. "Ä°lan Ver" sekmesinden ilan oluÅŸtur!</p></div>');let i="";for(const e of a){const n=Re[e.productCode]||{name:e.productCode,icon:"ğŸ“¦"};i+=`\n                <div class="glass-panel" style="padding:20px; border-radius:16px; border:2px solid rgba(0,255,136,0.2);">\n                    <div style="font-size:2rem; text-align:center; margin-bottom:10px;">${n.icon}</div>\n                    <h4 style="margin:0 0 5px 0; text-align:center;">${n.name}</h4>\n                    <div style="text-align:center; margin-bottom:10px;">\n                        <span style="font-size:1.3rem; font-weight:700;">${e.quantity}</span> adet\n                    </div>\n                    <div style="text-align:center; font-size:1.1rem; font-weight:700; margin-bottom:15px; color:var(--primary);">\n                        ğŸ’° ${e.totalPrice.toLocaleString()}\n                    </div>\n                    <button onclick="cancelMarketListing('${e.id}')" class="logout-btn" style="width:100%;">Ä°lanÄ± Ä°ptal Et</button>\n                </div>\n            `}t.innerHTML=i}catch(e){N("Ä°lanlarÄ±nÄ±z yÃ¼klenemedi!","error"),console.error("My listings error:",e)}}async function kn(){const e=(await w()).inventory||{},n=document.getElementById("new-listing-product");let t='<option value="">ÃœrÃ¼n SeÃ§</option>';for(const[n,a]of Object.entries(e))if(a>0){const e=Re[n]||{name:n,icon:"ğŸ“¦"};t+=`<option value="${n}">${e.icon} ${e.name} (${a} adet)</option>`}n.innerHTML=t;const a=document.getElementById("new-listing-quantity"),i=document.getElementById("new-listing-price"),r=()=>{const e=parseInt(a.value)||0,n=parseInt(i.value)||0;document.getElementById("listing-preview-qty").textContent=e||"-",document.getElementById("listing-preview-unit").textContent=n?`${n.toLocaleString()} ğŸ’°`:"-",document.getElementById("listing-preview-total").textContent=(e*n).toLocaleString()+" ğŸ’°"};a.addEventListener("input",r),i.addEventListener("input",r)}async function xn(){const e=document.getElementById("new-listing-product").value,n=parseInt(document.getElementById("new-listing-quantity").value),t=parseInt(document.getElementById("new-listing-price").value);if(!e)return N("ÃœrÃ¼n seÃ§!","error");if(!n||n<1)return N("GeÃ§erli bir miktar gir!","error");if(!t||t<1)return N("GeÃ§erli bir fiyat gir!","error");try{const a=await fetch("/api/marketplace/create-listing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,productCode:e,quantity:n,pricePerUnit:t})}),i=await a.json();N(i.message||i.error,i.success?"success":"error"),i.success&&(document.getElementById("new-listing-quantity").value="",document.getElementById("new-listing-price").value="",document.getElementById("new-listing-product").value="",document.getElementById("listing-preview-qty").textContent="-",document.getElementById("listing-preview-unit").textContent="-",document.getElementById("listing-preview-total").textContent="0 ğŸ’°",bn("my-listings"))}catch(e){N("Hata: "+e.message,"error")}}async function wn(e){Ke("SatÄ±n Alma","Bu Ã¼rÃ¼nÃ¼ satÄ±n almak istediÄŸine emin misin?").then(async n=>{if(n)try{const n=await fetch("/api/marketplace/buy-listing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,listingId:e})}),t=await n.json();N(t.message||t.error,t.success?"success":"error"),t.success&&vn()}catch(e){N("Hata: "+e.message,"error")}})}async function $n(e){Ke("Ä°lan Ä°ptali","Ä°lanÄ± iptal etmek istediÄŸine emin misin? ÃœrÃ¼nler stokuna geri dÃ¶ner.").then(async n=>{if(n)try{const n=await fetch("/api/marketplace/cancel-listing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,listingId:e})}),t=await n.json();N(t.message||t.error,t.success?"success":"error"),t.success&&hn()}catch(e){N("Hata: "+e.message,"error")}})}async function zn(){try{const e=await fetch("/api/warehouse/info?username="+l),n=await e.json();if(n.success){const e=n.level||0,t=n.capacity||5e3;document.getElementById("warehouse-level").textContent=e,document.getElementById("warehouse-capacity").textContent=t;const a=5e4*(e+1);document.getElementById("warehouse-upgrade-btn").innerHTML=`ğŸ“¦ Depo YÃ¼kselt (${a.toLocaleString()} ğŸ’°)`}}catch(e){console.error("Warehouse info error:",e)}}async function Sn(){Ke("Depo YÃ¼kseltme","Depoyu yÃ¼kseltmek istediÄŸine emin misin? Her seviye +500 kapasite ekler.").then(async e=>{if(e)try{const e=await fetch("/api/warehouse/upgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l})}),n=await e.json();N(n.message||n.error,n.success?"success":"error"),n.success&&zn()}catch(e){N("Hata: "+e.message,"error")}})}async function _n(){try{const e=await w(),n=e.inventory||{},t=e.productQualities||{},a=document.getElementById("rnd-upgrades-container");let i="";const r=Object.entries(n).filter(([e,n])=>n>0);if(0===r.length)return void(a.innerHTML='<div style="grid-column:1/-1; text-align:center; padding:60px; opacity:0.5;"><p>Deponuzda Ã¼rÃ¼n bulunmuyor. AR-GE yapabilmek iÃ§in Ã¶nce Ã¼rÃ¼n stoklamalÄ±sÄ±nÄ±z!</p></div>');for(const[e,n]of r){const a=Re[e]||{name:e,icon:"ğŸ“¦"},r=t[e]||0,o=5,s=25e3*(r/o+1),c=r>=100;i+=`\n                <div class="glass-panel" style="padding:20px; border-radius:16px; border:1px solid rgba(255,255,255,0.05);">\n                    <div style="font-size:2.5rem; text-align:center; margin-bottom:10px;">${a.icon}</div>\n                    <h4 style="margin:0 0 5px 0; text-align:center;">${a.name}</h4>\n                    <p style="font-size:0.8rem; color:#888; text-align:center; margin-bottom:10px;">Stokta: ${n} adet</p>\n                    <div style="text-align:center; margin-bottom:15px;">\n                        <div style="font-size:0.75rem; color:#aaa; text-transform:uppercase;">Mevcut Kalite</div>\n                        <div style="font-size:1.8rem; font-weight:800; color:var(--secondary);">%${r}</div>\n                    </div>\n                    ${c?'<div style="text-align:center; color:var(--primary); font-weight:700;">âœ… MAKSÄ°MUM</div>':`<button onclick="buyRnDUpgrade('${e}')" class="buy-btn" style="width:100%;">ğŸ§¬ %${r+o} Yap (ğŸ’° ${s.toLocaleString()})</button>`}\n                </div>\n            `}a.innerHTML=i}catch(e){console.error("R&D load error:",e),document.getElementById("rnd-upgrades-container").innerHTML='<div style="grid-column:1/-1; text-align:center; padding:60px; opacity:0.5;"><p>YÃ¼klenemedi.</p></div>'}}async function An(e){Ke("AR-GE YÃ¼kseltme","Bu yÃ¼kseltmeyi satÄ±n almak istediÄŸine emin misin?").then(async n=>{if(n)try{const n=await fetch("/api/rnd/buy-upgrade",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,upgradeType:e})}),t=await n.json();N(t.message||t.error,t.success?"success":"error"),t.success&&_n()}catch(e){N("Hata: "+e.message,"error")}})}